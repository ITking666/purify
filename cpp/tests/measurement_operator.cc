#include "catch.hpp"
#include "MeasurementOperator.h"
#include "utilities.h"
#include "pfitsio.h"
#include "directories.h"
#include <iomanip>

using namespace purify;
using namespace purify::notinstalled;

TEST_CASE("Measurement Operator [Kaiser Bessel Linear Interpolation]", "[KB_Interp]") {
  
  utilities::vis_params uv_vis;
  t_real max;
  t_real max_diff;
  t_real over_sample;
  t_real cellsize;
  std::string kernel;
  std::string vis_file = vla_filename("at166B.3C129.c0.vis");

  //Gridding example
  cellsize = 0.3;
  over_sample = 1.375;
  t_int J = 4;
  uv_vis = utilities::read_visibility(vis_file); // visibility data being read in
  t_int width = 1024;
  t_int height = 1024;

  uv_vis = utilities::set_cell_size(uv_vis, cellsize); // scale uv coordinates to correct pixel size and to units of 2pi
  uv_vis = utilities::uv_scale(uv_vis, floor(width * over_sample), floor(height * over_sample)); // scale uv coordinates to units of Fourier grid size
  uv_vis = utilities::uv_symmetry(uv_vis); // Enforce condjugate symmetry by reflecting measurements in uv coordinates

  kernel = "kb_interp";
  MeasurementOperator op(uv_vis.u, uv_vis.v, uv_vis.weights, J, J, kernel, width, height, over_sample); // Generating gridding matrix
  
  Vector<t_complex> point_source = uv_vis.vis * 0; point_source.setOnes();  // Creating model visibilities for point source
  Image<t_complex> psf;
  psf = op.grid(point_source);
  max = psf.real().maxCoeff();
  psf = psf / max;
  pfitsio::write2d(psf.real(), output_filename("kb_interp_psf.fits"), true, false);

  Image<t_real> kb_img = op.grid(uv_vis.vis).real();
  max = kb_img.maxCoeff();
  kb_img = kb_img / max;
  pfitsio::write2d(kb_img.real(), output_filename("grid_image_real_kb_interp_4.fits"), true, false);
  pfitsio::write2d(op.S.real(), output_filename("scale_kb_interp_4.fits"), true, false);

}

TEST_CASE("Measurement Operator [Kaiser Bessel]", "[KB_Non-Interp]") {
  
  utilities::vis_params uv_vis;
  t_real max;
  t_real max_diff;
  t_real over_sample;
  t_real cellsize;
  std::string kernel;
  std::string vis_file = vla_filename("at166B.3C129.c0.vis");


  //Gridding example
  cellsize = 0.3;
  over_sample = 2;
  t_int J = 4;
  uv_vis = utilities::read_visibility(vis_file); // visibility data being read in
  t_int width = 1024;
  t_int height = 1024;
  uv_vis = utilities::set_cell_size(uv_vis, cellsize); // scale uv coordinates to correct pixel size and to units of 2pi
  uv_vis = utilities::uv_scale(uv_vis, floor(width * over_sample), floor(height * over_sample)); // scale uv coordinates to units of Fourier grid size
  uv_vis = utilities::uv_symmetry(uv_vis); // Enforce condjugate symmetry by reflecting measurements in uv coordinates

  kernel = "kb";
  MeasurementOperator op(uv_vis.u, uv_vis.v, uv_vis.weights, J, J, kernel, width, height, over_sample); // Generating gridding matrix
 
  Vector<t_complex> point_source = uv_vis.vis * 0; point_source.setOnes();  // Creating model visibilities for point source
  Image<t_complex> psf;
  psf = op.grid(point_source);
  max = psf.real().maxCoeff();
  psf = psf / max;
  pfitsio::write2d(psf.real(), output_filename("kb_psf.fits"), true, false);

  Image<t_real> kb_img = op.grid(uv_vis.vis).real();
  max = kb_img.maxCoeff();
  kb_img = kb_img / max;
  pfitsio::write2d(kb_img.real(), output_filename("grid_image_real_kb_4.fits"), true, false);
  pfitsio::write2d(op.S.real(), output_filename("scale_kb_4.fits"), true, false);

}

TEST_CASE("Measurement Operator [Kernels]", "[Kernels]") {
  Vector<t_real> u(1);
  u << 1;
  Vector<t_complex> w(1);
  w << 1;
  MeasurementOperator op(u, u, w, 6, 6, "kb", 1, 1, 1);
  t_real x_values[] = {-3,-2.99000000000000,-2.98000000000000,-2.97000000000000,-2.96000000000000,-2.95000000000000,-2.94000000000000,-2.93000000000000,-2.92000000000000,-2.91000000000000,-2.90000000000000,-2.89000000000000,-2.88000000000000,-2.87000000000000,-2.86000000000000,-2.85000000000000,-2.84000000000000,-2.83000000000000,-2.82000000000000,-2.81000000000000,-2.80000000000000,-2.79000000000000,-2.78000000000000,-2.77000000000000,-2.76000000000000,-2.75000000000000,-2.74000000000000,-2.73000000000000,-2.72000000000000,-2.71000000000000,-2.70000000000000,-2.69000000000000,-2.68000000000000,-2.67000000000000,-2.66000000000000,-2.65000000000000,-2.64000000000000,-2.63000000000000,-2.62000000000000,-2.61000000000000,-2.60000000000000,-2.59000000000000,-2.58000000000000,-2.57000000000000,-2.56000000000000,-2.55000000000000,-2.54000000000000,-2.53000000000000,-2.52000000000000,-2.51000000000000,-2.50000000000000,-2.49000000000000,-2.48000000000000,-2.47000000000000,-2.46000000000000,-2.45000000000000,-2.44000000000000,-2.43000000000000,-2.42000000000000,-2.41000000000000,-2.40000000000000,-2.39000000000000,-2.38000000000000,-2.37000000000000,-2.36000000000000,-2.35000000000000,-2.34000000000000,-2.33000000000000,-2.32000000000000,-2.31000000000000,-2.30000000000000,-2.29000000000000,-2.28000000000000,-2.27000000000000,-2.26000000000000,-2.25000000000000,-2.24000000000000,-2.23000000000000,-2.22000000000000,-2.21000000000000,-2.20000000000000,-2.19000000000000,-2.18000000000000,-2.17000000000000,-2.16000000000000,-2.15000000000000,-2.14000000000000,-2.13000000000000,-2.12000000000000,-2.11000000000000,-2.10000000000000,-2.09000000000000,-2.08000000000000,-2.07000000000000,-2.06000000000000,-2.05000000000000,-2.04000000000000,-2.03000000000000,-2.02000000000000,-2.01000000000000,-2,-1.99000000000000,-1.98000000000000,-1.97000000000000,-1.96000000000000,-1.95000000000000,-1.94000000000000,-1.93000000000000,-1.92000000000000,-1.91000000000000,-1.90000000000000,-1.89000000000000,-1.88000000000000,-1.87000000000000,-1.86000000000000,-1.85000000000000,-1.84000000000000,-1.83000000000000,-1.82000000000000,-1.81000000000000,-1.80000000000000,-1.79000000000000,-1.78000000000000,-1.77000000000000,-1.76000000000000,-1.75000000000000,-1.74000000000000,-1.73000000000000,-1.72000000000000,-1.71000000000000,-1.70000000000000,-1.69000000000000,-1.68000000000000,-1.67000000000000,-1.66000000000000,-1.65000000000000,-1.64000000000000,-1.63000000000000,-1.62000000000000,-1.61000000000000,-1.60000000000000,-1.59000000000000,-1.58000000000000,-1.57000000000000,-1.56000000000000,-1.55000000000000,-1.54000000000000,-1.53000000000000,-1.52000000000000,-1.51000000000000,-1.50000000000000,-1.49000000000000,-1.48000000000000,-1.47000000000000,-1.46000000000000,-1.45000000000000,-1.44000000000000,-1.43000000000000,-1.42000000000000,-1.41000000000000,-1.40000000000000,-1.39000000000000,-1.38000000000000,-1.37000000000000,-1.36000000000000,-1.35000000000000,-1.34000000000000,-1.33000000000000,-1.32000000000000,-1.31000000000000,-1.30000000000000,-1.29000000000000,-1.28000000000000,-1.27000000000000,-1.26000000000000,-1.25000000000000,-1.24000000000000,-1.23000000000000,-1.22000000000000,-1.21000000000000,-1.20000000000000,-1.19000000000000,-1.18000000000000,-1.17000000000000,-1.16000000000000,-1.15000000000000,-1.14000000000000,-1.13000000000000,-1.12000000000000,-1.11000000000000,-1.10000000000000,-1.09000000000000,-1.08000000000000,-1.07000000000000,-1.06000000000000,-1.05000000000000,-1.04000000000000,-1.03000000000000,-1.02000000000000,-1.01000000000000,-1,-0.990000000000000,-0.980000000000000,-0.970000000000000,-0.960000000000000,-0.950000000000000,-0.940000000000000,-0.930000000000000,-0.920000000000000,-0.910000000000000,-0.900000000000000,-0.890000000000000,-0.880000000000000,-0.870000000000000,-0.860000000000000,-0.850000000000000,-0.840000000000000,-0.830000000000000,-0.820000000000000,-0.810000000000000,-0.800000000000000,-0.790000000000000,-0.780000000000000,-0.770000000000000,-0.760000000000000,-0.750000000000000,-0.740000000000000,-0.730000000000000,-0.720000000000000,-0.710000000000000,-0.700000000000000,-0.690000000000000,-0.680000000000000,-0.670000000000000,-0.660000000000000,-0.650000000000000,-0.640000000000000,-0.630000000000000,-0.620000000000000,-0.610000000000000,-0.600000000000000,-0.590000000000000,-0.580000000000000,-0.570000000000000,-0.560000000000000,-0.550000000000000,-0.540000000000000,-0.530000000000000,-0.520000000000000,-0.510000000000000,-0.500000000000000,-0.490000000000000,-0.480000000000000,-0.470000000000000,-0.460000000000000,-0.450000000000000,-0.440000000000000,-0.430000000000000,-0.420000000000000,-0.410000000000000,-0.400000000000000,-0.390000000000000,-0.380000000000000,-0.370000000000000,-0.360000000000000,-0.350000000000000,-0.340000000000000,-0.330000000000000,-0.320000000000000,-0.310000000000000,-0.300000000000000,-0.290000000000000,-0.280000000000000,-0.270000000000000,-0.260000000000000,-0.250000000000000,-0.240000000000000,-0.230000000000000,-0.220000000000000,-0.210000000000000,-0.200000000000000,-0.190000000000000,-0.180000000000000,-0.170000000000000,-0.160000000000000,-0.150000000000000,-0.140000000000000,-0.130000000000000,-0.120000000000000,-0.110000000000000,-0.100000000000000,-0.0899999999999999,-0.0800000000000001,-0.0699999999999998,-0.0600000000000001,-0.0499999999999998,-0.0400000000000000,-0.0299999999999998,-0.0200000000000000,-0.00999999999999979,0,0.00999999999999979,0.0200000000000000,0.0299999999999998,0.0400000000000000,0.0499999999999998,0.0600000000000001,0.0699999999999998,0.0800000000000001,0.0899999999999999,0.100000000000000,0.110000000000000,0.120000000000000,0.130000000000000,0.140000000000000,0.150000000000000,0.160000000000000,0.170000000000000,0.180000000000000,0.190000000000000,0.200000000000000,0.210000000000000,0.220000000000000,0.230000000000000,0.240000000000000,0.250000000000000,0.260000000000000,0.270000000000000,0.280000000000000,0.290000000000000,0.300000000000000,0.310000000000000,0.320000000000000,0.330000000000000,0.340000000000000,0.350000000000000,0.360000000000000,0.370000000000000,0.380000000000000,0.390000000000000,0.400000000000000,0.410000000000000,0.420000000000000,0.430000000000000,0.440000000000000,0.450000000000000,0.460000000000000,0.470000000000000,0.480000000000000,0.490000000000000,0.500000000000000,0.510000000000000,0.520000000000000,0.530000000000000,0.540000000000000,0.550000000000000,0.560000000000000,0.570000000000000,0.580000000000000,0.590000000000000,0.600000000000000,0.610000000000000,0.620000000000000,0.630000000000000,0.640000000000000,0.650000000000000,0.660000000000000,0.670000000000000,0.680000000000000,0.690000000000000,0.700000000000000,0.710000000000000,0.720000000000000,0.730000000000000,0.740000000000000,0.750000000000000,0.760000000000000,0.770000000000000,0.780000000000000,0.790000000000000,0.800000000000000,0.810000000000000,0.820000000000000,0.830000000000000,0.840000000000000,0.850000000000000,0.860000000000000,0.870000000000000,0.880000000000000,0.890000000000000,0.900000000000000,0.910000000000000,0.920000000000000,0.930000000000000,0.940000000000000,0.950000000000000,0.960000000000000,0.970000000000000,0.980000000000000,0.990000000000000,1,1.01000000000000,1.02000000000000,1.03000000000000,1.04000000000000,1.05000000000000,1.06000000000000,1.07000000000000,1.08000000000000,1.09000000000000,1.10000000000000,1.11000000000000,1.12000000000000,1.13000000000000,1.14000000000000,1.15000000000000,1.16000000000000,1.17000000000000,1.18000000000000,1.19000000000000,1.20000000000000,1.21000000000000,1.22000000000000,1.23000000000000,1.24000000000000,1.25000000000000,1.26000000000000,1.27000000000000,1.28000000000000,1.29000000000000,1.30000000000000,1.31000000000000,1.32000000000000,1.33000000000000,1.34000000000000,1.35000000000000,1.36000000000000,1.37000000000000,1.38000000000000,1.39000000000000,1.40000000000000,1.41000000000000,1.42000000000000,1.43000000000000,1.44000000000000,1.45000000000000,1.46000000000000,1.47000000000000,1.48000000000000,1.49000000000000,1.50000000000000,1.51000000000000,1.52000000000000,1.53000000000000,1.54000000000000,1.55000000000000,1.56000000000000,1.57000000000000,1.58000000000000,1.59000000000000,1.60000000000000,1.61000000000000,1.62000000000000,1.63000000000000,1.64000000000000,1.65000000000000,1.66000000000000,1.67000000000000,1.68000000000000,1.69000000000000,1.70000000000000,1.71000000000000,1.72000000000000,1.73000000000000,1.74000000000000,1.75000000000000,1.76000000000000,1.77000000000000,1.78000000000000,1.79000000000000,1.80000000000000,1.81000000000000,1.82000000000000,1.83000000000000,1.84000000000000,1.85000000000000,1.86000000000000,1.87000000000000,1.88000000000000,1.89000000000000,1.90000000000000,1.91000000000000,1.92000000000000,1.93000000000000,1.94000000000000,1.95000000000000,1.96000000000000,1.97000000000000,1.98000000000000,1.99000000000000,2,2.01000000000000,2.02000000000000,2.03000000000000,2.04000000000000,2.05000000000000,2.06000000000000,2.07000000000000,2.08000000000000,2.09000000000000,2.10000000000000,2.11000000000000,2.12000000000000,2.13000000000000,2.14000000000000,2.15000000000000,2.16000000000000,2.17000000000000,2.18000000000000,2.19000000000000,2.20000000000000,2.21000000000000,2.22000000000000,2.23000000000000,2.24000000000000,2.25000000000000,2.26000000000000,2.27000000000000,2.28000000000000,2.29000000000000,2.30000000000000,2.31000000000000,2.32000000000000,2.33000000000000,2.34000000000000,2.35000000000000,2.36000000000000,2.37000000000000,2.38000000000000,2.39000000000000,2.40000000000000,2.41000000000000,2.42000000000000,2.43000000000000,2.44000000000000,2.45000000000000,2.46000000000000,2.47000000000000,2.48000000000000,2.49000000000000,2.50000000000000,2.51000000000000,2.52000000000000,2.53000000000000,2.54000000000000,2.55000000000000,2.56000000000000,2.57000000000000,2.58000000000000,2.59000000000000,2.60000000000000,2.61000000000000,2.62000000000000,2.63000000000000,2.64000000000000,2.65000000000000,2.66000000000000,2.67000000000000,2.68000000000000,2.69000000000000,2.70000000000000,2.71000000000000,2.72000000000000,2.73000000000000,2.74000000000000,2.75000000000000,2.76000000000000,2.77000000000000,2.78000000000000,2.79000000000000,2.80000000000000,2.81000000000000,2.82000000000000,2.83000000000000,2.84000000000000,2.85000000000000,2.86000000000000,2.87000000000000,2.88000000000000,2.89000000000000,2.90000000000000,2.91000000000000,2.92000000000000,2.93000000000000,2.94000000000000,2.95000000000000,2.96000000000000,2.97000000000000,2.98000000000000,2.99000000000000,3};
  t_real pswf_values[] = {0,2.86633764298305e-05,6.10846400522510e-05,9.74867114534197e-05,0.000138099275436011,0.000183158834715579,0.000232908759839985,0.000287599335260365,0.000347487801482491,0.000412838393227599,0.000483922373532247,0.000561018063717058,0.000644410869154929,0.000734393300769595,0.000831264992196336,0.000935332712537120,0.00104691037464341,0.00116631903886053,0.00129388691216873,0.00142994934265658,0.00157484880926400,0.00172893490673290,0.00189256432570485,0.00206610082790644,0.00224991521636458,0.00244438530059500,0.00264989585670940,0.00286683858238768,0.00309561204666389,0.00333662163447619,0.00359027948593289,0.00385700443024882,0.00413722191430810,0.00443136392581194,0.00473986891097181,0.00506318168671114,0.00540175334734086,0.00575604116567666,0.00612650848856852,0.00651362462681571,0.00691786473944308,0.00733970971231783,0.00777964603108813,0.00823816564842889,0.00871576584558228,0.00921294908818468,0.00973022287637387,0.0102680995891754,0.0108270963231686,0.0114077347254377,0.0120105408208164,0.0126360448334390,0.0132847810026130,0.0139572873930336,0.0146541056993654,0.0153757810452170,0.0161228617765427,0.0168958992495060,0.0176954476128461,0.0185220635847929,0.0193763062245777,0.0202587366985953,0.0211699180412740,0.0221104149107163,0.0230807933391785,0.0240816204784586,0.0251134643402719,0.0261768935316915,0.0272724769857440,0.0284007836872455,0.0295623823939785,0.0307578413533050,0.0319877280143243,0.0332526087356823,0.0345530484891478,0.0358896256250000,0.0372628731910778,0.0386733693229407,0.0401216707418761,0.0416083313712472,0.0431339020245731,0.0446989300905778,0.0463039592153665,0.0479495289818953,0.0496361745868978,0.0513644265154379,0.0531348102132585,0.0549478457571002,0.0568040475231635,0.0587039238538933,0.0606479767232639,0.0626367014007467,0.0646705861141433,0.0667501117114703,0.0688757513220816,0.0710479700172189,0.0732672244701787,0.0755339626162902,0.0778486233128962,0.0802116359995324,0.0826234203585025,0.0850843859760454,0.0875949320042938,0.0901554468242243,0.0927663077097996,0.0954278804935044,0.0981405192334776,0.100904565882443,0.103720349958646,0.106588188218989,0.109508384334590,0.112481228568947,0.115506997458931,0.118585953498792,0.121718344827413,0.124904404918983,0.128144352277314,0.131438390134002,0.134786706150630,0.138189472125222,0.141646843703139,0.145158960092630,0.148725943785234,0.152347900281221,0.156024917820285,0.159757067117674,0.163544401105951,0.167386954682584,0.171284744463553,0.175237768543162,0.179246006260240,0.183309417970919,0.187427944828171,0.191601508568284,0.195830011304447,0.200113335327629,0.204451342914916,0.208843876145476,0.213290756724322,0.217791785814026,0.222346743874551,0.226955390511359,0.231617464331931,0.236332682810872,0.241100742163720,0.245921317229620,0.250794061362988,0.255718606334302,0.260694562240146,0.265721517422636,0.270799038398339,0.275926669796807,0.281103934308841,0.286330332644570,0.291605343501472,0.296928423542418,0.302299007383825,0.307716507594023,0.313180314701895,0.318689797215877,0.324244301653390,0.329843152580757,0.335485652663674,0.341171082728286,0.346898701832912,0.352667747350463,0.358477435061591,0.364326959258596,0.370215492860113,0.376142187536609,0.382106173846686,0.388106561384206,0.394142438936235,0.400212874651809,0.406316916221489,0.412453591067706,0.418621906545869,0.424820850156189,0.431049389766206,0.437306473843954,0.443591031701730,0.449901973750396,0.456238191764172,0.462598559155827,0.468981931262213,0.475387145640055,0.481813022371900,0.488258364382151,0.494721957763063,0.501202572110616,0.507698960870139,0.514209861691576,0.520733996794259,0.527270073341071,0.533816783821854,0.540372806445917,0.546936805543511,0.553507431976100,0.560083323555276,0.566663105470158,0.573245390723099,0.579828780573518,0.586411864989690,0.592993223108302,0.599571423701575,0.606145025651764,0.612712578432832,0.619272622599090,0.625823690280586,0.632364305685044,0.638892985606103,0.645408239937661,0.651908572194071,0.658392480035969,0.664858455801489,0.671304987042621,0.677730557066477,0.684133645481194,0.690512728746252,0.696866280726914,0.703192773252561,0.709490676678633,0.715758460451928,0.721994593678982,0.728197545697252,0.734365786648846,0.740497788056505,0.746592023401566,0.752646968703630,0.758661103101640,0.764632909436099,0.770560874832130,0.776443491283096,0.782279256234493,0.788066673167824,0.793804252184162,0.799490510587115,0.805123973464901,0.810703174271229,0.816226655404721,0.821692968786546,0.827100676436013,0.832448351043794,0.837734576542518,0.842957948674420,0.848117075555774,0.853210578237811,0.858237091263836,0.863195263222258,0.868083757295261,0.872901251802801,0.877646440741690,0.882318034319456,0.886914759482714,0.891435360439777,0.895878599177233,0.900243255970207,0.904528129886074,0.908732039281311,0.912853822291283,0.916892337312664,0.920846463478258,0.924715101123971,0.928497172247691,0.932191620959817,0.935797413925227,0.939313540796430,0.942739014637679,0.946072872339833,0.949314175025725,0.952462008445847,0.955515483364125,0.958473735933589,0.961335928061722,0.964101247765328,0.966768909514690,0.969338154566861,0.971808251287910,0.974178495463931,0.976448210600678,0.978616748211639,0.980683488094415,0.982647838595249,0.984509236861565,0.986267149082369,0.987921070716417,0.989470526707983,0.990915071690158,0.992254290175525,0.993487796734152,0.994615236158772,0.995636283617083,0.996550644791080,0.997358056003338,0.998058284330194,0.998651127701744,0.999136414988631,0.999514006075548,0.999783791921433,0.999945694606328,0.999999667364857,0.999945694606328,0.999783791921433,0.999514006075548,0.999136414988631,0.998651127701744,0.998058284330194,0.997358056003338,0.996550644791080,0.995636283617083,0.994615236158772,0.993487796734152,0.992254290175525,0.990915071690158,0.989470526707983,0.987921070716417,0.986267149082369,0.984509236861565,0.982647838595249,0.980683488094415,0.978616748211639,0.976448210600678,0.974178495463931,0.971808251287910,0.969338154566861,0.966768909514690,0.964101247765328,0.961335928061722,0.958473735933589,0.955515483364125,0.952462008445847,0.949314175025725,0.946072872339833,0.942739014637679,0.939313540796430,0.935797413925227,0.932191620959817,0.928497172247691,0.924715101123971,0.920846463478258,0.916892337312664,0.912853822291283,0.908732039281311,0.904528129886074,0.900243255970207,0.895878599177233,0.891435360439777,0.886914759482714,0.882318034319456,0.877646440741690,0.872901251802801,0.868083757295261,0.863195263222258,0.858237091263836,0.853210578237811,0.848117075555774,0.842957948674420,0.837734576542518,0.832448351043794,0.827100676436013,0.821692968786546,0.816226655404721,0.810703174271229,0.805123973464901,0.799490510587115,0.793804252184162,0.788066673167824,0.782279256234493,0.776443491283096,0.770560874832130,0.764632909436099,0.758661103101640,0.752646968703630,0.746592023401566,0.740497788056505,0.734365786648846,0.728197545697252,0.721994593678982,0.715758460451928,0.709490676678633,0.703192773252561,0.696866280726914,0.690512728746252,0.684133645481194,0.677730557066477,0.671304987042621,0.664858455801489,0.658392480035969,0.651908572194071,0.645408239937661,0.638892985606103,0.632364305685044,0.625823690280586,0.619272622599090,0.612712578432832,0.606145025651764,0.599571423701575,0.592993223108302,0.586411864989690,0.579828780573518,0.573245390723099,0.566663105470158,0.560083323555276,0.553507431976100,0.546936805543511,0.540372806445917,0.533816783821854,0.527270073341071,0.520733996794259,0.514209861691576,0.507698960870139,0.501202572110616,0.494721957763063,0.488258364382151,0.481813022371900,0.475387145640055,0.468981931262213,0.462598559155827,0.456238191764172,0.449901973750396,0.443591031701730,0.437306473843954,0.431049389766206,0.424820850156189,0.418621906545869,0.412453591067706,0.406316916221489,0.400212874651809,0.394142438936235,0.388106561384206,0.382106173846686,0.376142187536609,0.370215492860113,0.364326959258596,0.358477435061591,0.352667747350463,0.346898701832912,0.341171082728286,0.335485652663674,0.329843152580757,0.324244301653390,0.318689797215877,0.313180314701895,0.307716507594023,0.302299007383825,0.296928423542418,0.291605343501472,0.286330332644570,0.281103934308841,0.275926669796807,0.270799038398339,0.265721517422636,0.260694562240146,0.255718606334302,0.250794061362988,0.245921317229620,0.241100742163720,0.236332682810872,0.231617464331931,0.226955390511359,0.222346743874551,0.217791785814026,0.213290756724322,0.208843876145476,0.204451342914916,0.200113335327629,0.195830011304447,0.191601508568284,0.187427944828171,0.183309417970919,0.179246006260240,0.175237768543162,0.171284744463553,0.167386954682584,0.163544401105951,0.159757067117674,0.156024917820285,0.152347900281221,0.148725943785234,0.145158960092630,0.141646843703139,0.138189472125222,0.134786706150630,0.131438390134002,0.128144352277314,0.124904404918983,0.121718344827413,0.118585953498792,0.115506997458931,0.112481228568947,0.109508384334590,0.106588188218989,0.103720349958646,0.100904565882443,0.0981405192334776,0.0954278804935044,0.0927663077097996,0.0901554468242243,0.0875949320042938,0.0850843859760454,0.0826234203585025,0.0802116359995324,0.0778486233128962,0.0755339626162902,0.0732672244701787,0.0710479700172189,0.0688757513220816,0.0667501117114703,0.0646705861141433,0.0626367014007467,0.0606479767232639,0.0587039238538933,0.0568040475231635,0.0549478457571002,0.0531348102132585,0.0513644265154379,0.0496361745868978,0.0479495289818953,0.0463039592153665,0.0446989300905778,0.0431339020245731,0.0416083313712472,0.0401216707418761,0.0386733693229407,0.0372628731910778,0.0358896256250000,0.0345530484891478,0.0332526087356823,0.0319877280143243,0.0307578413533050,0.0295623823939785,0.0284007836872455,0.0272724769857440,0.0261768935316915,0.0251134643402719,0.0240816204784586,0.0230807933391785,0.0221104149107163,0.0211699180412740,0.0202587366985953,0.0193763062245777,0.0185220635847929,0.0176954476128461,0.0168958992495060,0.0161228617765427,0.0153757810452170,0.0146541056993654,0.0139572873930336,0.0132847810026130,0.0126360448334390,0.0120105408208164,0.0114077347254377,0.0108270963231686,0.0102680995891754,0.00973022287637387,0.00921294908818468,0.00871576584558228,0.00823816564842889,0.00777964603108813,0.00733970971231783,0.00691786473944308,0.00651362462681571,0.00612650848856852,0.00575604116567666,0.00540175334734086,0.00506318168671114,0.00473986891097181,0.00443136392581194,0.00413722191430810,0.00385700443024882,0.00359027948593289,0.00333662163447619,0.00309561204666389,0.00286683858238768,0.00264989585670940,0.00244438530059500,0.00224991521636458,0.00206610082790644,0.00189256432570485,0.00172893490673290,0.00157484880926400,0.00142994934265658,0.00129388691216873,0.00116631903886053,0.00104691037464341,0.000935332712537120,0.000831264992196336,0.000734393300769595,0.000644410869154929,0.000561018063717058,0.000483922373532247,0.000412838393227599,0.000347487801482491,0.000287599335260365,0.000232908759839985,0.000183158834715579,0.000138099275436011,9.74867114534197e-05,6.10846400522510e-05,2.86633764298305e-05,0};
  t_real kb_values[] = {7.43469443502669e-06,1.00805758527258e-05,1.31611100296223e-05,1.67204973730424e-05,2.08059363905017e-05,2.54677549797957e-05,3.07595444911051e-05,3.67382965053836e-05,4.34645422677190e-05,5.10024947086680e-05,5.94201929808341e-05,6.87896494321026e-05,7.91869989310889e-05,9.06926504543629e-05,0.000103391440839045,0.000117372790598282,0.000132730861691048,0.000149564717131562,0.000167978482317502,0.000188081507949999,0.000209988534412247,0.000233819857467383,0.000259701495130145,0.000287765355560641,0.000318149405822505,0.000350997841341567,0.000386461255895199,0.000424696811956460,0.000465868411211272,0.000510146865061051,0.000557710064917393,0.000608743152089792,0.000663438687061795,0.000721996817945560,0.000784625447899411,0.000851540401287862,0.000922965588358437,0.000999133168204828,0.00108028370978106,0.00116666635072691,0.00125853895376027,0.00135616826038822,0.00145983004168424,0.00156980924587551,0.00168640014248058,0.00180990646273441,0.00194064153603439,0.00207892842213892,0.00222510003884643,0.00237949928488150,0.00254247915771185,0.00271440286601900,0.00289564393654305,0.00308658631502198,0.00328762446094390,0.00349916343583111,0.00372161898477411,0.00395541761093375,0.00420099664273084,0.00445880429344256,0.00472929971292675,0.00501295303119638,0.00531024539356870,0.00562166898711538,0.00594772705814315,0.00628893392043690,0.00664581495400105,0.00701890659403844,0.00740875630991058,0.00781592257382674,0.00824097481901578,0.00868449338713837,0.00914706946470409,0.00962930500826366,0.0101318126581527,0.0106552156405711,0.0112001476577889,0.0117672527662767,0.0123571852425686,0.0129706094366715,0.0136081996128458,0.0142706397775905,0.0149586234946749,0.0156728536870719,0.0164140424256529,0.0171829107045218,0.0179801882028699,0.0188066130332503,0.0196629314761796,0.0205498977009858,0.0214682734728370,0.0224188278458950,0.0234023368425520,0.0244195831187241,0.0254713556151832,0.0265584491949310,0.0276816642666247,0.0288418063940844,0.0300396858919227,0.0312761174073554,0.0325519194882648,0.0338679141376024,0.0352249263542347,0.0366237836603505,0.0380653156155631,0.0395503533178591,0.0410797288915580,0.0426542749624655,0.0442748241204196,0.0459422083694431,0.0476572585657329,0.0494208038437357,0.0512336710305704,0.0530966840490786,0.0550106633098010,0.0569764250921886,0.0589947809153793,0.0610665368988864,0.0631924931135554,0.0653734429231685,0.0676101723170910,0.0699034592343620,0.0722540728796589,0.0746627730315699,0.0771303093436293,0.0796574206385861,0.0822448341963846,0.0848932650363573,0.0876034151941392,0.0903759729938291,0.0932116123159342,0.0961109918616499,0.0990747544140367,0.102103526096669,0.105197915630347,0.108358513588461,0.111585891651624,0.114880601862191,0.118243175879295,0.121674124235024,0.125173935592412,0.128743076005881,0.132381988184787,0.136091090760777,0.139870777559591,0.143721416878019,0.147643350766696,0.151636894319412,0.155702334969659,0.159839931795092,0.164049914830625,0.168332484390842,0.172687810402464,0.177116031747545,0.181617255618122,0.186191556883019,0.190838977467515,0.195559525746569,0.200353175952304,0.205219867596454,0.210159504908447,0.215171956289834,0.220257053785717,0.225414592573868,0.230644330472202,0.235945987465250,0.241319245250294,0.246763746803798,0.252279095968757,0.257864857063589,0.263520554513175,0.269245672502630,0.275039654654401,0.280901903729233,0.286831781351579,0.292828607759967,0.298891661582857,0.305020179640481,0.311213356773146,0.317470345696486,0.323790256884076,0.330172158477869,0.336615076226841,0.343117993454229,0.349679851053751,0.356299547515114,0.362975938979164,0.369707839322947,0.376494020274986,0.383333211560984,0.390224101080214,0.397165335112778,0.404155518557911,0.411193215203480,0.418276948026807,0.425405199526899,0.432576412088166,0.439788988375669,0.447041291761895,0.454331646785080,0.461658339638999,0.469019618694186,0.476413695050466,0.483838743120690,0.491292901245497,0.498774272338951,0.506280924564807,0.513810892043182,0.521362175587379,0.528932743470522,0.536520532221727,0.544123447451410,0.551739364705383,0.559366130347294,0.567001562469006,0.574643451828413,0.582289562814228,0.589937634437199,0.597585381347206,0.605230494875692,0.612870644102763,0.620503476948407,0.628126621287106,0.635737686085219,0.643334262560384,0.650913925362262,0.658474233773817,0.666012732932407,0.673526955069859,0.681014420770724,0.688472640247859,0.695899114634501,0.703291337291929,0.710646795131823,0.717962969952412,0.725237339787475,0.732467380267226,0.739650565990148,0.746784371904763,0.753866274700369,0.760893754205708,0.767864294794583,0.774775386797333,0.781624527917188,0.788409224650396,0.795126993709089,0.801775363445819,0.808351875278672,0.814854085115884,0.821279564778882,0.827625903422644,0.833890708952285,0.840071609434801,0.846166254504825,0.852172316763347,0.858087493168273,0.863909506415738,0.869636106311106,0.875265071128524,0.880794208958001,0.886221359038912,0.891544393078866,0.896761216556889,0.901869770009860,0.906868030301180,0.911754011870646,0.916525767964508,0.921181391844709,0.925719017976353,0.930136823192383,0.934433027834571,0.938605896869844,0.942653740981037,0.946574917631207,0.950367832100585,0.954030938495344,0.957562740727331,0.960961793463961,0.964226703047482,0.967356128382838,0.970348781793416,0.973203429843927,0.975918894129774,0.978494052032215,0.980927837438710,0.983219241427842,0.985367312918236,0.987371159280924,0.989229946914677,0.990942901783765,0.992509309917736,0.993928517872787,0.995199933154319,0.996323024600329,0.997297322725331,0.998122420024500,0.998797971237777,0.999323693573725,0.999699366892946,0.999924833850901,1,0.999924833850901,0.999699366892946,0.999323693573725,0.998797971237777,0.998122420024500,0.997297322725331,0.996323024600329,0.995199933154319,0.993928517872787,0.992509309917736,0.990942901783765,0.989229946914677,0.987371159280924,0.985367312918236,0.983219241427842,0.980927837438710,0.978494052032215,0.975918894129774,0.973203429843927,0.970348781793416,0.967356128382838,0.964226703047482,0.960961793463961,0.957562740727331,0.954030938495344,0.950367832100585,0.946574917631207,0.942653740981037,0.938605896869844,0.934433027834571,0.930136823192383,0.925719017976353,0.921181391844709,0.916525767964508,0.911754011870646,0.906868030301180,0.901869770009860,0.896761216556889,0.891544393078866,0.886221359038912,0.880794208958001,0.875265071128524,0.869636106311106,0.863909506415738,0.858087493168273,0.852172316763347,0.846166254504825,0.840071609434801,0.833890708952285,0.827625903422644,0.821279564778882,0.814854085115884,0.808351875278672,0.801775363445819,0.795126993709089,0.788409224650396,0.781624527917188,0.774775386797333,0.767864294794583,0.760893754205708,0.753866274700369,0.746784371904763,0.739650565990148,0.732467380267226,0.725237339787475,0.717962969952412,0.710646795131823,0.703291337291929,0.695899114634501,0.688472640247859,0.681014420770724,0.673526955069859,0.666012732932407,0.658474233773817,0.650913925362262,0.643334262560384,0.635737686085219,0.628126621287106,0.620503476948407,0.612870644102763,0.605230494875692,0.597585381347206,0.589937634437199,0.582289562814228,0.574643451828413,0.567001562469006,0.559366130347294,0.551739364705383,0.544123447451410,0.536520532221727,0.528932743470522,0.521362175587379,0.513810892043182,0.506280924564807,0.498774272338951,0.491292901245497,0.483838743120690,0.476413695050466,0.469019618694186,0.461658339638999,0.454331646785080,0.447041291761895,0.439788988375669,0.432576412088166,0.425405199526899,0.418276948026807,0.411193215203480,0.404155518557911,0.397165335112778,0.390224101080214,0.383333211560984,0.376494020274986,0.369707839322947,0.362975938979164,0.356299547515114,0.349679851053751,0.343117993454229,0.336615076226841,0.330172158477869,0.323790256884076,0.317470345696486,0.311213356773146,0.305020179640481,0.298891661582857,0.292828607759967,0.286831781351579,0.280901903729233,0.275039654654401,0.269245672502630,0.263520554513175,0.257864857063589,0.252279095968757,0.246763746803798,0.241319245250294,0.235945987465250,0.230644330472202,0.225414592573868,0.220257053785717,0.215171956289834,0.210159504908447,0.205219867596454,0.200353175952304,0.195559525746569,0.190838977467515,0.186191556883019,0.181617255618122,0.177116031747545,0.172687810402464,0.168332484390842,0.164049914830625,0.159839931795092,0.155702334969659,0.151636894319412,0.147643350766696,0.143721416878019,0.139870777559591,0.136091090760777,0.132381988184787,0.128743076005881,0.125173935592412,0.121674124235024,0.118243175879295,0.114880601862191,0.111585891651624,0.108358513588461,0.105197915630347,0.102103526096669,0.0990747544140367,0.0961109918616499,0.0932116123159342,0.0903759729938291,0.0876034151941392,0.0848932650363573,0.0822448341963846,0.0796574206385861,0.0771303093436293,0.0746627730315699,0.0722540728796589,0.0699034592343620,0.0676101723170910,0.0653734429231685,0.0631924931135554,0.0610665368988864,0.0589947809153793,0.0569764250921886,0.0550106633098010,0.0530966840490786,0.0512336710305704,0.0494208038437357,0.0476572585657329,0.0459422083694431,0.0442748241204196,0.0426542749624655,0.0410797288915580,0.0395503533178591,0.0380653156155631,0.0366237836603505,0.0352249263542347,0.0338679141376024,0.0325519194882648,0.0312761174073554,0.0300396858919227,0.0288418063940844,0.0276816642666247,0.0265584491949310,0.0254713556151832,0.0244195831187241,0.0234023368425520,0.0224188278458950,0.0214682734728370,0.0205498977009858,0.0196629314761796,0.0188066130332503,0.0179801882028699,0.0171829107045218,0.0164140424256529,0.0156728536870719,0.0149586234946749,0.0142706397775905,0.0136081996128458,0.0129706094366715,0.0123571852425686,0.0117672527662767,0.0112001476577889,0.0106552156405711,0.0101318126581527,0.00962930500826366,0.00914706946470409,0.00868449338713837,0.00824097481901578,0.00781592257382674,0.00740875630991058,0.00701890659403844,0.00664581495400105,0.00628893392043690,0.00594772705814315,0.00562166898711538,0.00531024539356870,0.00501295303119638,0.00472929971292675,0.00445880429344256,0.00420099664273084,0.00395541761093375,0.00372161898477411,0.00349916343583111,0.00328762446094390,0.00308658631502198,0.00289564393654305,0.00271440286601900,0.00254247915771185,0.00237949928488150,0.00222510003884643,0.00207892842213892,0.00194064153603439,0.00180990646273441,0.00168640014248058,0.00156980924587551,0.00145983004168424,0.00135616826038822,0.00125853895376027,0.00116666635072691,0.00108028370978106,0.000999133168204828,0.000922965588358437,0.000851540401287862,0.000784625447899411,0.000721996817945560,0.000663438687061795,0.000608743152089792,0.000557710064917393,0.000510146865061051,0.000465868411211272,0.000424696811956460,0.000386461255895199,0.000350997841341567,0.000318149405822505,0.000287765355560641,0.000259701495130145,0.000233819857467383,0.000209988534412247,0.000188081507949999,0.000167978482317502,0.000149564717131562,0.000132730861691048,0.000117372790598282,0.000103391440839045,9.06926504543629e-05,7.91869989310889e-05,6.87896494321026e-05,5.94201929808341e-05,5.10024947086680e-05,4.34645422677190e-05,3.67382965053836e-05,3.07595444911051e-05,2.54677549797957e-05,2.08059363905017e-05,1.67204973730424e-05,1.31611100296223e-05,1.00805758527258e-05,7.43469443502669e-06};
  t_real gauss_values[] = {0.000699879769063488,0.000734550335813170,0.000770813962412435,0.000808737299262344,0.000848389458032121,0.000889842087032812,0.000933169448195548,0.000978448495656672,0.00102575895595036,0.00107518340980737,0.00112680737555679,0.00118071939412560,0.00123701111562861,0.00129577738753945,0.00135711634443075,0.00142112949926929,0.00148792183624960,0.00155760190514682,0.00163028191716677,0.00170607784226887,0.00178510950793429,0.00186750069934881,0.00195337926096717,0.00204287719942195,0.00213613078773737,0.00223328067080457,0.00233447197207188,0.00243985440139970,0.00254958236402629,0.00266381507058677,0.00278271664812404,0.00290645625202629,0.00303520817882174,0.00316915197975733,0.00330847257508363,0.00345336036896434,0.00360401136492399,0.00376062728174355,0.00392341566970854,0.00409259002711025,0.00426836991689576,0.00445098108335776,0.00464065556875038,0.00483763182971278,0.00504215485337676,0.00525447627303051,0.00547485448320485,0.00570355475404418,0.00594084934481857,0.00618701761642908,0.00644234614275277,0.00670712882066924,0.00698166697860525,0.00726626948342904,0.00756125284552083,0.00786694132184118,0.00818366701681348,0.00851176998083246,0.00885159830620527,0.00920350822032722,0.00956786417588879,0.00994503893790690,0.0103354136673680,0.0107393780012658,0.0111573301288138,0.0115896768636053,0.0120368337114932,0.0124992249339547,0.0129772836067038,0.0134714516733111,0.0139821799935847,0.0145099283864656,0.0150551656671856,0.0156183696784335,0.0162000273152735,0.0168006345435551,0.0174206964115545,0.0180607270545826,0.0187212496922949,0.0194027966184369,0.0201059091827567,0.0208311377648161,0.0215790417394323,0.0223501894334788,0.0231451580737793,0.0239645337258231,0.0248089112230371,0.0256788940863468,0.0265750944337617,0.0274981328797241,0.0284486384239596,0.0294272483295739,0.0304346079901428,0.0314713707855435,0.0325381979262851,0.0336357582860962,0.0347647282225337,0.0359257913853865,0.0371196385126465,0.0383469672138356,0.0396084817404756,0.0409048927435024,0.0422369170174299,0.0436052772310812,0.0450107016447105,0.0464539238133536,0.0479356822762494,0.0494567202321930,0.0510177852006850,0.0526196286687601,0.0542630057233863,0.0559486746693428,0.0576773966324938,0.0594499351483950,0.0612670557361800,0.0631295254576919,0.0650381124618393,0.0669935855141739,0.0689967135117022,0.0710482649829623,0.0731490075734142,0.0752997075162107,0.0775011290884327,0.0797540340528955,0.0820591810856499,0.0844173251893211,0.0868292170924514,0.0892956026350324,0.0918172221404328,0.0943948097739498,0.0970290928882350,0.0997207913558665,0.102470616889362,0.105279272348950,0.108147451038438,0.111075835989545,0.114065099235078,0.117115901071369,0.120228889310397,0.123404698522063,0.126643949267090,0.129947247321051,0.133315182890056,0.136748329818647,0.140247244790477,0.143812466522364,0.147444514952346,0.151143890422381,0.154911072856348,0.158746520934044,0.162650671261893,0.166623937541076,0.170666709733863,0.174779353228893,0.178962208006213,0.183215587802879,0.187539779279958,0.191935041191769,0.196401603558241,0.200939666841274,0.205549401125988,0.210230945307796,0.214984406286217,0.219809858166382,0.224707341469186,0.229676862351052,0.234718391834299,0.239831865049088,0.245017180487957,0.250274199273943,0.255602744443307,0.261002600243882,0.266473511450057,0.272015182695439,0.277627277824195,0.283309419262124,0.289061187408468,0.294882120049496,0.300771711794874,0.306729413537832,0.312754631940148,0.318846728942931,0.325005021304212,0.331228780164299,0.337517230639884,0.343869551447840,0.350284874559649,0.356762284887377,0.363300820002107,0.369899469885695,0.376557176716720,0.383272834691460,0.390045289880703,0.396873340123180,0.403755734956380,0.410691175585469,0.417678314891011,0.424715757476165,0.431802059753978,0.438935730075381,0.446115228898436,0.453338968999378,0.460605315725911,0.467912587293223,0.475259055123106,0.482642944226556,0.490062433630159,0.497515656846536,0.505000702389078,0.512515614331134,0.520058392909812,0.527626995174436,0.535219335679730,0.542833287223675,0.550466681629998,0.558117310575161,0.565782926459664,0.573461243323464,0.581149937805200,0.588846650144909,0.596548985229844,0.604254513682941,0.611960772993456,0.619665268689203,0.627365475549802,0.635058838860270,0.642742775704245,0.650414676296073,0.658071905350936,0.665711803492151,0.673331688694706,0.680928857764055,0.688500587849150,0.696044137988615,0.703556750688933,0.711035653533477,0.718478060821137,0.725881175233287,0.733242189527750,0.740558288258413,0.747826649519071,0.755044446710050,0.762208850326119,0.769317029764164,0.776366155149043,0.783353399176031,0.790275938968212,0.797130957947146,0.803915647715110,0.810627209947195,0.817262858291488,0.823819820275572,0.830295339217536,0.836686676139680,0.842991111683067,0.849205948021079,0.855328510770093,0.861356150895418,0.867286246610587,0.873116205268119,0.878843465239859,0.884465497784977,0.889979808903757,0.895383941175252,0.900675475576940,0.905852033284487,0.910911277449748,0.915850914955168,0.920668698142714,0.925362426515542,0.929929948410593,0.934369162640325,0.938678020101856,0.942854525351773,0.946896738144925,0.950802774935535,0.954570810339018,0.958199078552896,0.961685874735289,0.965029556339449,0.968228544402904,0.971281324789764,0.974186449384856,0.976942537238333,0.979548275659527,0.982002421258801,0.984303800936268,0.986451312816259,0.988443927126510,0.990280687021073,0.991960709346049,0.993483185347261,0.994847381319100,0.996052639193792,0.997098377070437,0.997984089683222,0.998709348808275,0.999273803608710,0.999677180917468,0.999919285457637,1,0.999919285457637,0.999677180917468,0.999273803608710,0.998709348808275,0.997984089683222,0.997098377070437,0.996052639193792,0.994847381319100,0.993483185347261,0.991960709346049,0.990280687021073,0.988443927126510,0.986451312816259,0.984303800936268,0.982002421258801,0.979548275659527,0.976942537238333,0.974186449384856,0.971281324789764,0.968228544402904,0.965029556339449,0.961685874735289,0.958199078552896,0.954570810339018,0.950802774935535,0.946896738144925,0.942854525351773,0.938678020101856,0.934369162640325,0.929929948410593,0.925362426515542,0.920668698142714,0.915850914955168,0.910911277449748,0.905852033284487,0.900675475576940,0.895383941175252,0.889979808903757,0.884465497784977,0.878843465239859,0.873116205268119,0.867286246610587,0.861356150895418,0.855328510770093,0.849205948021079,0.842991111683067,0.836686676139680,0.830295339217536,0.823819820275572,0.817262858291488,0.810627209947195,0.803915647715110,0.797130957947146,0.790275938968212,0.783353399176031,0.776366155149043,0.769317029764164,0.762208850326119,0.755044446710050,0.747826649519071,0.740558288258413,0.733242189527750,0.725881175233287,0.718478060821137,0.711035653533477,0.703556750688933,0.696044137988615,0.688500587849150,0.680928857764055,0.673331688694706,0.665711803492151,0.658071905350936,0.650414676296073,0.642742775704245,0.635058838860270,0.627365475549802,0.619665268689203,0.611960772993456,0.604254513682941,0.596548985229844,0.588846650144909,0.581149937805200,0.573461243323464,0.565782926459664,0.558117310575161,0.550466681629998,0.542833287223675,0.535219335679730,0.527626995174436,0.520058392909812,0.512515614331134,0.505000702389078,0.497515656846536,0.490062433630159,0.482642944226556,0.475259055123106,0.467912587293223,0.460605315725911,0.453338968999378,0.446115228898436,0.438935730075381,0.431802059753978,0.424715757476165,0.417678314891011,0.410691175585469,0.403755734956380,0.396873340123180,0.390045289880703,0.383272834691460,0.376557176716720,0.369899469885695,0.363300820002107,0.356762284887377,0.350284874559649,0.343869551447840,0.337517230639884,0.331228780164299,0.325005021304212,0.318846728942931,0.312754631940148,0.306729413537832,0.300771711794874,0.294882120049496,0.289061187408468,0.283309419262124,0.277627277824195,0.272015182695439,0.266473511450057,0.261002600243882,0.255602744443307,0.250274199273943,0.245017180487957,0.239831865049088,0.234718391834299,0.229676862351052,0.224707341469186,0.219809858166382,0.214984406286217,0.210230945307796,0.205549401125988,0.200939666841274,0.196401603558241,0.191935041191769,0.187539779279958,0.183215587802879,0.178962208006213,0.174779353228893,0.170666709733863,0.166623937541076,0.162650671261893,0.158746520934044,0.154911072856348,0.151143890422381,0.147444514952346,0.143812466522364,0.140247244790477,0.136748329818647,0.133315182890056,0.129947247321051,0.126643949267090,0.123404698522063,0.120228889310397,0.117115901071369,0.114065099235078,0.111075835989545,0.108147451038438,0.105279272348950,0.102470616889362,0.0997207913558665,0.0970290928882350,0.0943948097739498,0.0918172221404328,0.0892956026350324,0.0868292170924514,0.0844173251893211,0.0820591810856499,0.0797540340528955,0.0775011290884327,0.0752997075162107,0.0731490075734142,0.0710482649829623,0.0689967135117022,0.0669935855141739,0.0650381124618393,0.0631295254576919,0.0612670557361800,0.0594499351483950,0.0576773966324938,0.0559486746693428,0.0542630057233863,0.0526196286687601,0.0510177852006850,0.0494567202321930,0.0479356822762494,0.0464539238133536,0.0450107016447105,0.0436052772310812,0.0422369170174299,0.0409048927435024,0.0396084817404756,0.0383469672138356,0.0371196385126465,0.0359257913853865,0.0347647282225337,0.0336357582860962,0.0325381979262851,0.0314713707855435,0.0304346079901428,0.0294272483295739,0.0284486384239596,0.0274981328797241,0.0265750944337617,0.0256788940863468,0.0248089112230371,0.0239645337258231,0.0231451580737793,0.0223501894334788,0.0215790417394323,0.0208311377648161,0.0201059091827567,0.0194027966184369,0.0187212496922949,0.0180607270545826,0.0174206964115545,0.0168006345435551,0.0162000273152735,0.0156183696784335,0.0150551656671856,0.0145099283864656,0.0139821799935847,0.0134714516733111,0.0129772836067038,0.0124992249339547,0.0120368337114932,0.0115896768636053,0.0111573301288138,0.0107393780012658,0.0103354136673680,0.00994503893790690,0.00956786417588879,0.00920350822032722,0.00885159830620527,0.00851176998083246,0.00818366701681348,0.00786694132184118,0.00756125284552083,0.00726626948342904,0.00698166697860525,0.00670712882066924,0.00644234614275277,0.00618701761642908,0.00594084934481857,0.00570355475404418,0.00547485448320485,0.00525447627303051,0.00504215485337676,0.00483763182971278,0.00464065556875038,0.00445098108335776,0.00426836991689576,0.00409259002711025,0.00392341566970854,0.00376062728174355,0.00360401136492399,0.00345336036896434,0.00330847257508363,0.00316915197975733,0.00303520817882174,0.00290645625202629,0.00278271664812404,0.00266381507058677,0.00254958236402629,0.00243985440139970,0.00233447197207188,0.00223328067080457,0.00213613078773737,0.00204287719942195,0.00195337926096717,0.00186750069934881,0.00178510950793429,0.00170607784226887,0.00163028191716677,0.00155760190514682,0.00148792183624960,0.00142112949926929,0.00135711634443075,0.00129577738753945,0.00123701111562861,0.00118071939412560,0.00112680737555679,0.00107518340980737,0.00102575895595036,0.000978448495656672,0.000933169448195548,0.000889842087032812,0.000848389458032121,0.000808737299262344,0.000770813962412435,0.000734550335813170,0.000699879769063488};

  
  t_int number_of_samples = sizeof(x_values) / sizeof(*x_values);
  for (t_int i = 0; i < number_of_samples; ++i)
  {
    //Test that pswf is the same as matlab calculations
    t_real pswf_difference = std::abs(op.pswf(x_values[i], 6) - pswf_values[i]);
    CHECK( pswf_difference < 1e-13 );
    //Test that kaiser_bessel is the same as matlab calculations
    t_real kb_difference = std::abs(op.kaiser_bessel(x_values[i], 6) - kb_values[i]);
    CHECK( kb_difference < 1e-13 );
    //Test that gaussian is the same as matlab calculations
    t_real gauss_difference = std::abs(op.gaussian(x_values[i], 6) - gauss_values[i]);
    CHECK( gauss_difference < 1e-13 );
  }
}

TEST_CASE("Measurement Operator [Kernel Gridding Correction]", "[Gridding_Correction]") {
  Vector<t_real> u(1);
  u << 1;
  Vector<t_complex> w(1);
  w << 1;
  MeasurementOperator op(u, u, w, 6, 6, "kb", 1, 1, 1);
  t_real x_values[] = {-1,-0.990000000000000,-0.980000000000000,-0.970000000000000,-0.960000000000000,-0.950000000000000,-0.940000000000000,-0.930000000000000,-0.920000000000000,-0.910000000000000,-0.900000000000000,-0.890000000000000,-0.880000000000000,-0.870000000000000,-0.860000000000000,-0.850000000000000,-0.840000000000000,-0.830000000000000,-0.820000000000000,-0.810000000000000,-0.800000000000000,-0.790000000000000,-0.780000000000000,-0.770000000000000,-0.760000000000000,-0.750000000000000,-0.740000000000000,-0.730000000000000,-0.720000000000000,-0.710000000000000,-0.700000000000000,-0.690000000000000,-0.680000000000000,-0.670000000000000,-0.660000000000000,-0.650000000000000,-0.640000000000000,-0.630000000000000,-0.620000000000000,-0.610000000000000,-0.600000000000000,-0.590000000000000,-0.580000000000000,-0.570000000000000,-0.560000000000000,-0.550000000000000,-0.540000000000000,-0.530000000000000,-0.520000000000000,-0.510000000000000,-0.500000000000000,-0.490000000000000,-0.480000000000000,-0.470000000000000,-0.460000000000000,-0.450000000000000,-0.440000000000000,-0.430000000000000,-0.420000000000000,-0.410000000000000,-0.400000000000000,-0.390000000000000,-0.380000000000000,-0.370000000000000,-0.360000000000000,-0.350000000000000,-0.340000000000000,-0.330000000000000,-0.320000000000000,-0.310000000000000,-0.300000000000000,-0.290000000000000,-0.280000000000000,-0.270000000000000,-0.260000000000000,-0.250000000000000,-0.240000000000000,-0.230000000000000,-0.220000000000000,-0.210000000000000,-0.200000000000000,-0.190000000000000,-0.180000000000000,-0.170000000000000,-0.160000000000000,-0.150000000000000,-0.140000000000000,-0.130000000000000,-0.120000000000000,-0.110000000000000,-0.100000000000000,-0.0900000000000000,-0.0800000000000000,-0.0700000000000000,-0.0599999999999999,-0.0499999999999999,-0.0400000000000000,-0.0300000000000000,-0.0200000000000000,-0.0100000000000000,0,0.0100000000000000,0.0200000000000000,0.0300000000000000,0.0400000000000000,0.0499999999999999,0.0599999999999999,0.0700000000000000,0.0800000000000000,0.0900000000000000,0.100000000000000,0.110000000000000,0.120000000000000,0.130000000000000,0.140000000000000,0.150000000000000,0.160000000000000,0.170000000000000,0.180000000000000,0.190000000000000,0.200000000000000,0.210000000000000,0.220000000000000,0.230000000000000,0.240000000000000,0.250000000000000,0.260000000000000,0.270000000000000,0.280000000000000,0.290000000000000,0.300000000000000,0.310000000000000,0.320000000000000,0.330000000000000,0.340000000000000,0.350000000000000,0.360000000000000,0.370000000000000,0.380000000000000,0.390000000000000,0.400000000000000,0.410000000000000,0.420000000000000,0.430000000000000,0.440000000000000,0.450000000000000,0.460000000000000,0.470000000000000,0.480000000000000,0.490000000000000,0.500000000000000,0.510000000000000,0.520000000000000,0.530000000000000,0.540000000000000,0.550000000000000,0.560000000000000,0.570000000000000,0.580000000000000,0.590000000000000,0.600000000000000,0.610000000000000,0.620000000000000,0.630000000000000,0.640000000000000,0.650000000000000,0.660000000000000,0.670000000000000,0.680000000000000,0.690000000000000,0.700000000000000,0.710000000000000,0.720000000000000,0.730000000000000,0.740000000000000,0.750000000000000,0.760000000000000,0.770000000000000,0.780000000000000,0.790000000000000,0.800000000000000,0.810000000000000,0.820000000000000,0.830000000000000,0.840000000000000,0.850000000000000,0.860000000000000,0.870000000000000,0.880000000000000,0.890000000000000,0.900000000000000,0.910000000000000,0.920000000000000,0.930000000000000,0.940000000000000,0.950000000000000,0.960000000000000,0.970000000000000,0.980000000000000,0.990000000000000,1};
  t_real pswf_values[] = {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.00402855900000000,0.00588153433939356,0.00821952639228226,0.0111158669430303,0.0146478855232069,0.0188962078206995,0.0239439421424684,0.0298757528075581,0.0367768217498934,0.0447317023790150,0.0538230728460491,0.0641303992346064,0.0757285227611846,0.0886862748494166,0.103065146567479,0.118917601418165,0.136285759803160,0.155200092140847,0.175678099523451,0.197723107257007,0.221323193286154,0.246450272914332,0.273059360180902,0.301088024737891,0.330456061079659,0.361065384531118,0.392800165519523,0.425527210380104,0.459096593328513,0.493342540336922,0.528084561549678,0.563128824651590,0.598269757346345,0.633291862907367,0.667971728722788,0.702080203962751,0.735384719039146,0.767651716486410,0.798649160339165,0.828149089079260,0.855930175819319,0.881780258617002,0.905498803694023,0.926899264872818,0.945811303733580,0.962082836813986,0.975581878589836,0.986198151942241,0.993844441281575,0.998457667397153,0.999999667364857,0.998457667397153,0.993844441281575,0.986198151942241,0.975581878589836,0.962082836813986,0.945811303733580,0.926899264872818,0.905498803694023,0.881780258617002,0.855930175819319,0.828149089079260,0.798649160339165,0.767651716486410,0.735384719039146,0.702080203962751,0.667971728722788,0.633291862907367,0.598269757346345,0.563128824651590,0.528084561549678,0.493342540336922,0.459096593328513,0.425527210380104,0.392800165519523,0.361065384531118,0.330456061079659,0.301088024737891,0.273059360180902,0.246450272914332,0.221323193286154,0.197723107257007,0.175678099523451,0.155200092140847,0.136285759803160,0.118917601418165,0.103065146567479,0.0886862748494166,0.0757285227611846,0.0641303992346064,0.0538230728460491,0.0447317023790150,0.0367768217498934,0.0298757528075581,0.0239439421424684,0.0188962078206995,0.0146478855232069,0.0111158669430303,0.00821952639228226,0.00588153433939356,0.00402855900000000,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0};
  t_real kb_values[] = {2.20285645956888e-08,-5.65978970024670e-07,-1.14252882270768e-06,-1.65739161509457e-06,-2.05938910070430e-06,-2.30062311363058e-06,-2.34126053948774e-06,-2.15462115089311e-06,-1.73222442811505e-06,-1.08835503639540e-06,-2.63606763327717e-07,6.73235843310269e-07,1.62571705015641e-06,2.47346194701659e-06,3.08007487561432e-06,3.30616759649414e-06,3.02855243036611e-06,2.16666613934683e-06,7.17295598851346e-07,-1.20134726343265e-06,-3.29520947210833e-06,-5.02873872825884e-06,-5.54720922895997e-06,-3.58642402031131e-06,2.63060855841303e-06,1.55101829412959e-05,3.82174662971212e-05,7.48186915866401e-05,0.000130435187284355,0.000211408082882889,0.000325472133760779,0.000481936699157212,0.000691871490627306,0.000968294294094115,0.00132635746585675,0.00178352962162970,0.00235976858824408,0.00307768138059059,0.00396266671224037,0.00504303535716691,0.00635010356180290,0.00791825467018930,0.00978496417804989,0.0119907835808028,0.0145792786307987,0.0175969179737239,0.0210929085944489,0.0251189750678849,0.0297290802776623,0.0349790860294258,0.0409263528386977,0.0476292791057583,0.0551467808897721,0.0635377145473196,0.0728602455904844,0.0831711682290191,0.0945251811705973,0.106974126342665,0.120566198247675,0.135345132649515,0.151349384191101,0.168611303340757,0.187156323738390,0.207002171542739,0.228158108751835,0.250624222665355,0.274390773668275,0.299437613330604,0.325733684432752,0.353236613937489,0.381892409138879,0.411635266231421,0.442387499366591,0.474059596913169,0.506550410126689,0.539747477782625,0.573527488559878,0.607756881101008,0.642292579752258,0.676982862028333,0.711668351886751,0.746183130965846,0.780355958072011,0.814011585427741,0.846972158543965,0.879058685087848,0.910092556808574,0.939897107483774,0.968299188980497,0.995130746904553,1.02023037695707,1.04344484303436,1.06463053830531,1.08365487097812,1.10039755722211,1.11475180473198,1.12662537169722,1.13594148745054,1.14263962279469,1.14667609991988,1.14802453389575,1.14667609991988,1.14263962279469,1.13594148745054,1.12662537169722,1.11475180473198,1.10039755722211,1.08365487097812,1.06463053830531,1.04344484303436,1.02023037695707,0.995130746904553,0.968299188980497,0.939897107483774,0.910092556808574,0.879058685087848,0.846972158543965,0.814011585427741,0.780355958072011,0.746183130965846,0.711668351886751,0.676982862028333,0.642292579752258,0.607756881101008,0.573527488559878,0.539747477782625,0.506550410126689,0.474059596913169,0.442387499366591,0.411635266231421,0.381892409138879,0.353236613937489,0.325733684432752,0.299437613330604,0.274390773668275,0.250624222665355,0.228158108751835,0.207002171542739,0.187156323738390,0.168611303340757,0.151349384191101,0.135345132649515,0.120566198247675,0.106974126342665,0.0945251811705973,0.0831711682290191,0.0728602455904844,0.0635377145473196,0.0551467808897721,0.0476292791057583,0.0409263528386977,0.0349790860294258,0.0297290802776623,0.0251189750678849,0.0210929085944489,0.0175969179737239,0.0145792786307987,0.0119907835808028,0.00978496417804989,0.00791825467018930,0.00635010356180290,0.00504303535716691,0.00396266671224037,0.00307768138059059,0.00235976858824408,0.00178352962162970,0.00132635746585675,0.000968294294094115,0.000691871490627306,0.000481936699157212,0.000325472133760779,0.000211408082882889,0.000130435187284355,7.48186915866401e-05,3.82174662971212e-05,1.55101829412959e-05,2.63060855841303e-06,-3.58642402031131e-06,-5.54720922895997e-06,-5.02873872825884e-06,-3.29520947210833e-06,-1.20134726343265e-06,7.17295598851346e-07,2.16666613934683e-06,3.02855243036611e-06,3.30616759649414e-06,3.08007487561432e-06,2.47346194701659e-06,1.62571705015641e-06,6.73235843310269e-07,-2.63606763327717e-07,-1.08835503639540e-06,-1.73222442811505e-06,-2.15462115089311e-06,-2.34126053948774e-06,-2.30062311363058e-06,-2.05938910070430e-06,-1.65739161509457e-06,-1.14252882270768e-06,-5.65978970024670e-07,2.20285645956888e-08};
  t_real gauss_values[] = {7.79493274433476e-06,9.94228692044273e-06,1.26502224466048e-05,1.60563927676993e-05,2.03299239766315e-05,2.56780166749567e-05,3.23537890143938e-05,4.06655613866274e-05,5.09878084634825e-05,6.37740311948571e-05,7.95718297198766e-05,9.90404876110699e-05,0.000122971408011274,0.000152311772467652,0.000188191822900232,0.000231956195286902,0.000285199759252389,0.000349808439580846,0.000428005512304208,0.000522403877831003,0.000636064814761461,0.000772563708591247,0.000936063227281556,0.00113139437837454,0.00136414582756920,0.00164076178400285,0.00196864866047992,0.00235629059521048,0.00281337377309935,0.00335091930736851,0.00398142423479201,0.00471900993907302,0.00557957704653091,0.00658096553669976,0.00774311847898104,0.00908824744749947,0.0106409972833003,0.0124286074708006,0.0144810669801267,0.0168312590062418,0.0195150916186365,0.0225716099323464,0.0260430850340541,0.0299750745592136,0.0344164495317796,0.0394193818623717,0.0450392867692755,0.0513347143555023,0.0583671846598817,0.0662009607158526,0.0749027545119931,0.0845413612653258,0.0951872181015903,0.106911884092501,0.119787439631420,0.133885804334611,0.149277974029365,0.166033178921789,0.184217966709446,0.203895216195312,0.225123088841899,0.247953927644749,0.272433114664262,0.298597900490936,0.326476220784425,0.356085516771036,0.387431578155354,0.420507428246497,0.455292272165956,0.491750529741991,0.529830975058956,0.569466004578028,0.610571055244923,0.653044193025209,0.696765890843863,0.741599012948688,0.787389020275581,0.833964408488515,0.881137387032589,0.928704803822208,0.976449316148087,1.02414080409832,1.07153801833231,1.11839044951313,1.16444040219188,1.20942525154877,1.25307985723552,1.29513910473391,1.33534054124762,1.37342707027051,1.40914966670890,1.44227007284921,1.47256343461343,1.49982083747333,1.52385170212352,1.54448600154692,1.56157626342703,1.57499932493493,1.58465781068938,1.59048130908291,1.59242722709602,1.59048130908291,1.58465781068938,1.57499932493493,1.56157626342703,1.54448600154692,1.52385170212352,1.49982083747333,1.47256343461343,1.44227007284921,1.40914966670890,1.37342707027051,1.33534054124762,1.29513910473391,1.25307985723552,1.20942525154877,1.16444040219188,1.11839044951313,1.07153801833231,1.02414080409832,0.976449316148087,0.928704803822208,0.881137387032589,0.833964408488515,0.787389020275581,0.741599012948688,0.696765890843863,0.653044193025209,0.610571055244923,0.569466004578028,0.529830975058956,0.491750529741991,0.455292272165956,0.420507428246497,0.387431578155354,0.356085516771036,0.326476220784425,0.298597900490936,0.272433114664262,0.247953927644749,0.225123088841899,0.203895216195312,0.184217966709446,0.166033178921789,0.149277974029365,0.133885804334611,0.119787439631420,0.106911884092501,0.0951872181015903,0.0845413612653258,0.0749027545119931,0.0662009607158526,0.0583671846598817,0.0513347143555023,0.0450392867692755,0.0394193818623717,0.0344164495317796,0.0299750745592136,0.0260430850340541,0.0225716099323464,0.0195150916186365,0.0168312590062418,0.0144810669801267,0.0124286074708006,0.0106409972833003,0.00908824744749947,0.00774311847898104,0.00658096553669976,0.00557957704653091,0.00471900993907302,0.00398142423479201,0.00335091930736851,0.00281337377309935,0.00235629059521048,0.00196864866047992,0.00164076178400285,0.00136414582756920,0.00113139437837454,0.000936063227281556,0.000772563708591247,0.000636064814761461,0.000522403877831003,0.000428005512304208,0.000349808439580846,0.000285199759252389,0.000231956195286902,0.000188191822900232,0.000152311772467652,0.000122971408011274,9.90404876110699e-05,7.95718297198766e-05,6.37740311948571e-05,5.09878084634825e-05,4.06655613866274e-05,3.23537890143938e-05,2.56780166749567e-05,2.03299239766315e-05,1.60563927676993e-05,1.26502224466048e-05,9.94228692044273e-06,7.79493274433476e-06};

    t_int number_of_samples = sizeof(x_values) / sizeof(*x_values);
    for (t_int i = 0; i < number_of_samples; ++i)
    {
      
      t_real pswf_difference  = std::abs(op.ft_pswf(x_values[i], 6) - pswf_values[i]);
      CHECK( pswf_difference  < 1e-13 ); //Test that pswf is the same as matlab calculations
      
      t_real kb_difference = std::abs(op.ft_kaiser_bessel(x_values[i], 6) - kb_values[i]);
      CHECK( kb_difference < 1e-13 ); //Test that kaiser_bessel is the same as matlab calculations
      
      t_real gauss_difference = std::abs(op.ft_gaussian(x_values[i], 6) - gauss_values[i]);
      CHECK( gauss_difference < 1e-13 ); //Test that gaussian is the same as matlab calculations
    }
}

TEST_CASE("Measurement Operator [Check FT Grid]", "[Check_Grid]"){
  t_real max;
  t_real max_diff;
  t_int over_sample;
  t_real cellsize;
  std::string kernel;
  

  //Gridding example comparing with matlab's values
  over_sample = 2;
  t_int J = 6;
  Vector<t_real> u(21);
  Vector<t_real> v(21);
  Vector<t_complex> weights(21);
  weights.setOnes();
  u << -2,-1.70000000000000,-1.40000000000000,-1.10000000000000,-0.800000000000000,-0.500000000000000,
  -0.200000000000000,0.100000000000000,0.400000000000000,0.700000000000000,1,1.30000000000000,1.60000000000000,
  1.90000000000000,2.20000000000000,2.50000000000000,2.80000000000000,3.10000000000000,3.40000000000000,3.70000000000000,4;
  v << -5,-4.50000000000000,-4,-3.50000000000000,-3,-2.50000000000000,-2,-1.50000000000000,-1,-0.500000000000000,0,
  0.500000000000000,1,1.50000000000000,2,2.50000000000000,3,3.50000000000000,4,4.50000000000000,5;
  u = u * over_sample * 10/(2 * purify_pi);
  v = v * over_sample * 10/(2 * purify_pi);
  t_complex I(0., 1.);
  kernel = "kb";
  MeasurementOperator op(v, u, weights, J, J, kernel, 10, 10, over_sample); // Generating gridding matrix 
  Vector<t_int> k(756);
  Vector<t_int> l(756);
  k << 10,10,5,5,5,6,5,6,7,5,6,7,5,6,7,8,6,7,8,9,6,7,8,9,7,8,9,10,8,9,10,8,9,10,9,10,10,11,10,11,11,11,6,6,7,6,7,6,7,8,6,7,8,9,6,7,8,9,7,8,9,10,8,9,10,8,9,10,11,9,10,11,10,11,12,10,11,12,11,12,11,12,12,7,7,7,8,7,8,9,7,8,9,7,8,9,10,8,9,10,8,9,10,11,9,10,11,12,10,11,12,10,11,12,13,11,12,13,11,12,13,12,13,13,13,8,8,9,8,9,8,9,10,8,9,10,8,9,10,11,9,10,11,12,10,11,12,10,11,12,13,11,12,13,14,11,12,13,14,12,13,14,13,14,13,14,14,9,9,9,10,9,10,9,10,11,9,10,11,12,10,11,12,10,11,12,13,11,12,13,14,11,12,13,14,12,13,14,15,13,14,15,16,13,14,15,16,14,15,16,15,16,15,16,16,10,10,10,11,10,11,12,11,12,11,12,13,11,12,13,14,11,12,13,14,12,13,14,15,13,14,15,16,13,14,15,16,14,15,16,17,15,16,17,15,16,17,16,17,17,17,11,11,12,12,12,13,12,13,14,12,13,14,12,13,14,15,13,14,15,16,13,14,15,16,14,15,16,17,15,16,17,15,16,17,18,16,17,18,17,18,17,18,18,18,12,13,13,14,13,14,13,14,15,13,14,15,16,13,14,15,16,14,15,16,17,15,16,17,15,16,17,18,16,17,18,19,17,18,19,17,18,19,18,19,18,19,19,14,14,14,15,14,15,16,14,15,16,14,15,16,17,15,16,17,15,16,17,18,16,17,18,19,17,18,19,17,18,19,20,18,19,20,18,19,20,19,20,20,20,15,15,16,15,16,15,16,17,15,16,17,15,16,17,18,16,17,18,19,17,18,19,17,18,19,20,18,19,20,21,18,19,20,21,19,20,21,20,21,20,21,21,1,1,1,1,1,1,17,17,17,18,17,18,19,17,18,19,17,18,19,20,18,19,20,21,18,19,20,21,19,20,21,20,21,20,21,21,1,1,2,1,2,1,2,1,2,1,2,2,18,18,19,18,19,18,19,20,18,19,20,21,18,19,20,21,19,20,21,20,21,20,21,21,1,1,2,1,2,1,2,3,1,2,3,1,2,3,2,3,3,3,19,19,19,20,19,20,21,19,20,21,19,20,21,20,21,20,21,21,1,1,2,1,2,1,2,3,1,2,3,4,1,2,3,4,2,3,4,3,4,3,4,4,20,20,21,20,21,20,21,20,21,20,21,21,1,1,2,1,2,1,2,3,1,2,3,4,1,2,3,4,2,3,4,5,3,4,5,3,4,5,4,5,5,5,21,21,21,21,21,21,1,1,2,1,2,1,2,3,1,2,3,4,1,2,3,4,2,3,4,5,3,4,5,3,4,5,6,4,5,6,5,6,5,6,6,6,2,2,2,3,2,3,4,2,3,4,2,3,4,5,3,4,5,3,4,5,6,4,5,6,7,5,6,7,5,6,7,6,7,6,7,7,3,3,4,3,4,3,4,5,3,4,5,3,4,5,6,4,5,6,7,5,6,7,5,6,7,8,6,7,8,6,7,8,7,8,8,8,4,4,4,5,4,5,4,5,6,4,5,6,7,5,6,7,5,6,7,8,6,7,8,9,6,7,8,9,7,8,9,8,9,8,9,9;
  l << 1,2,9,10,11,11,12,12,12,13,13,13,14,14,14,14,15,15,15,15,16,16,16,16,17,17,17,17,18,18,18,19,19,19,20,20,21,21,22,22,23,24,31,32,32,33,33,34,34,34,35,35,35,35,36,36,36,36,37,37,37,37,38,38,38,39,39,39,39,40,40,40,41,41,41,42,42,42,43,43,44,44,45,52,53,54,54,55,55,55,56,56,56,57,57,57,57,58,58,58,59,59,59,59,60,60,60,60,61,61,61,62,62,62,62,63,63,63,64,64,64,65,65,66,67,74,75,75,76,76,77,77,77,78,78,78,79,79,79,79,80,80,80,80,81,81,81,82,82,82,82,83,83,83,83,84,84,84,84,85,85,85,86,86,87,87,88,95,96,97,97,98,98,99,99,99,100,100,100,100,101,101,101,102,102,102,102,103,103,103,103,104,104,104,104,105,105,105,105,106,106,106,106,107,107,107,107,108,108,108,109,109,110,110,111,117,118,119,119,120,120,120,121,121,122,122,122,123,123,123,123,124,124,124,124,125,125,125,125,126,126,126,126,127,127,127,127,128,128,128,128,129,129,129,130,130,130,131,131,132,133,139,140,140,141,142,142,143,143,143,144,144,144,145,145,145,145,146,146,146,146,147,147,147,147,148,148,148,148,149,149,149,150,150,150,150,151,151,151,152,152,153,153,154,155,160,162,163,163,164,164,165,165,165,166,166,166,166,167,167,167,167,168,168,168,168,169,169,169,170,170,170,170,171,171,171,171,172,172,172,173,173,173,174,174,175,175,176,183,184,185,185,186,186,186,187,187,187,188,188,188,188,189,189,189,190,190,190,190,191,191,191,191,192,192,192,193,193,193,193,194,194,194,195,195,195,196,196,197,198,205,206,206,207,207,208,208,208,209,209,209,210,210,210,210,211,211,211,211,212,212,212,213,213,213,213,214,214,214,214,215,215,215,215,216,216,216,217,217,218,218,219,223,224,225,226,227,228,228,229,230,230,231,231,231,232,232,232,233,233,233,233,234,234,234,234,235,235,235,235,236,236,236,237,237,238,238,239,243,244,244,245,245,246,246,247,247,248,248,249,250,251,251,252,252,253,253,253,254,254,254,254,255,255,255,255,256,256,256,257,257,258,258,259,263,264,264,265,265,266,266,266,267,267,267,268,268,268,269,269,270,271,271,272,273,273,274,274,274,275,275,275,276,276,276,277,277,278,278,279,283,284,284,285,285,286,286,286,287,287,287,287,288,288,288,288,289,289,289,290,290,291,291,292,293,294,294,295,295,296,296,297,297,298,298,299,303,304,304,305,305,306,306,306,307,307,307,307,308,308,308,308,309,309,309,309,310,310,310,311,311,311,312,312,313,314,314,315,316,317,318,319,323,324,324,325,325,326,326,326,327,327,327,327,328,328,328,328,329,329,329,329,330,330,330,331,331,331,331,332,332,332,333,333,334,334,335,336,344,345,346,346,347,347,347,348,348,348,349,349,349,349,350,350,350,351,351,351,351,352,352,352,352,353,353,353,354,354,354,355,355,356,356,357,366,367,367,368,368,369,369,369,370,370,370,371,371,371,371,372,372,372,372,373,373,373,374,374,374,374,375,375,375,376,376,376,377,377,378,379,387,388,389,389,390,390,391,391,391,392,392,392,392,393,393,393,394,394,394,394,395,395,395,395,396,396,396,396,397,397,397,398,398,399,399,400;
  Vector<t_complex> expected_values(756);
  expected_values << 0.00152201456019792 + 3.72786051880411e-18* I,-1.59182895411959e-05 + 1.56151320936083e-20* I,6.46302796167347e-06 + 2.21617942169771e-20* I,-0.000344801911956239 + 4.26851413919111e-22* I,0.00159106856878656 + 1.71507132264404e-17* I,0.00351554229840346 + 3.78953232929002e-17* I,-0.00147590886612960 - 1.08466295304519e-17* I,-0.0552424641374030 - 4.05983429328535e-16* I,-0.000712558556277874 - 5.23667745080209e-18* I,0.000267124495093880 + 1.04682610524983e-18* I,0.128013588902444 + 5.01668582069579e-16* I,0.0834993543792741 + 3.27223094628636e-16* I,-3.37416486911963e-06 - 1.64868699726784e-21* I,-0.0631923818316161 - 3.08771095347671e-17* I,-0.541566794501509 - 2.64620777845875e-16* I,-0.0111534434707801 + 2.18682536846183e-17* I,0.00492181649197720 - 1.44781543873588e-17* I,0.664191133456582 - 1.95380339526559e-15* I,0.285253010554530 + 4.89067860851851e-16* I,4.85514019801526e-05 + 8.32416466407546e-20* I,-2.79495885587382e-06 - 2.19096195170280e-20* I,-0.167112473200028 - 1.30999091334297e-15* I,-0.891727827538427 - 4.80613109522116e-15* I,-0.0178173197413390 - 9.60297209505410e-17* I,0.00422119194427231 + 1.86100891313028e-17* I,0.585718337577923 + 1.14767693970674e-15* I,0.167384632291077 + 3.27979286658759e-16* I,5.34293850223042e-05 + 1.04691400556762e-19* I,-0.0681290781208570 + 1.00205210099772e-16* I,-0.272046248724428 + 4.00129463984932e-16* I,-0.00244571532872098 + 3.59719263959470e-18* I,0.000254261920123736 + 5.60485883924268e-19* I,0.0933552084132581 + 2.05788882900655e-16* I,0.0104682016257592 + 2.30757293048673e-17* I,-0.00411313194813195 - 2.41833344968657e-17* I,-0.00910448204196804 - 5.35301899910157e-17* I,-0.0392438916870969 + 3.84965074906683e-17* I,-0.0147426533538016 - 1.80545432406722e-18* I,0.000410439983253054 + 4.02216831147203e-18* I,0.00680606886918939 + 1.66700609108585e-18* I,-0.000479901665016348 - 1.76313011390327e-19* I,1.09607122847037e-07 + 5.36920048633496e-23* I,-3.67679926748075e-05 - 2.70212344592682e-19* I,0.000577764209426459 + 2.26418268715524e-18* I,0.000109265983747093 + 4.28199159205005e-19* I,-0.00133885537408508 - 6.54192528254309e-19* I,-0.0128040552149943 - 6.25632716956371e-18* I,0.000660909991992891 - 1.94415149687492e-18* I,0.0830455659322556 - 2.44289181994628e-16* I,0.00845162652859676 + 1.44903603261688e-17* I,-5.14757887583796e-05 - 4.03517548626812e-19* I,-0.101849170084106 - 7.98393350219881e-16* I,-0.216153147472413 - 1.16499713400760e-15* I,-0.000164506473447785 - 8.86637887689453e-19* I,2.92316285842519e-08 + 1.28874313366446e-22* I,0.0256255554294265 + 1.12976115958873e-16* I,0.675715135263478 + 1.32401980405734e-15* I,0.0603703357142494 + 1.18291741433451e-16* I,-0.000647290929724450 - 6.33360891059852e-19* I,-0.443833570603369 + 6.52796682684410e-16* I,-0.567148515686855 + 8.34170045151055e-16* I,-0.00137763268076150 + 2.02624159938188e-18* I,0.0516254487256395 + 1.13801292965520e-16* I,0.921772949227078 + 2.03192332526080e-15* I,0.0630607551121704 + 1.39008873419882e-16* I,-0.000192669357670525 - 1.13280769559525e-18* I,-0.316314987573915 - 1.85978744356744e-15* I,-0.269913955820873 - 1.58697060082231e-15* I,-0.000479901665016348 + 5.87710037967756e-20* I,0.0139365044883608 + 3.41345912259475e-17* I,0.234751569706173 + 5.74975516870963e-16* I,0.00680606886918939 + 0.00000000000000* I,0.123259285644539 + 1.20789789748257e-15* I,0.334612041083106 + 8.19563130137177e-17* I,0.00232538582102692 + 5.69555260500650e-19* I,-0.00128913155553229 - 8.21099622738661e-18* I,-0.154476439309643 - 5.67537230832706e-17* I,-0.0139101385767516 - 5.11050200511447e-18* I,0.0108922642211412 + 5.33567060555513e-18* I,0.0159936759271383 + 7.83464161230800e-18* I,-2.48773827973349e-06 - 1.52330036069598e-21* I,-0.00373664739904749 - 2.28803663839290e-18* I,8.16312390210630e-05 + 5.99816613465464e-20* I,-9.19343533616609e-07 - 4.49210334612796e-22* I,0.000107730923772406 - 3.16904327744063e-19* I,-0.000698729846354239 - 5.47732752725142e-18* I,-0.00118663546978144 - 6.39559005997619e-18* I,0.000856939851818541 + 3.77801512772898e-18* I,0.0303485951287354 + 5.94660958128397e-17* I,0.000116325136301673 + 2.27931529331558e-19* I,-0.000215608626504532 - 2.10968616324091e-19* I,-0.0948725720734056 + 1.39539918630001e-16* I,-0.0426888218035190 + 6.27873218854518e-17* I,5.44618471553082e-06 + 6.40421500541534e-20* I,0.0623156567289946 + 1.37366405189871e-16* I,0.401039709914547 + 8.84037594740101e-16* I,0.00432694141205839 + 9.53815491067579e-18* I,-0.00724837856878157 - 4.26171505556413e-17* I,-0.651800270899787 - 3.83228745760907e-15* I,-0.198064546944180 - 1.16452894074956e-15* I,2.70513957258131e-05 + 6.62568103761709e-20* I,0.223671344188632 + 5.47836791443189e-16* I,0.847759993968976 + 2.07641312611857e-15* I,0.0108922642211412 + 0.00000000000000* I,-0.00985472334431879 + 9.66704408594030e-18* I,-0.737320116379557 + 7.23278150126955e-16* I,-0.154476439309643 - 1.89179076944235e-17* I,-2.43205063618343e-05 - 2.97840302696632e-21* I,-0.0813138686695894 - 5.17920662181390e-16* I,-0.975092360693128 - 3.58243121518763e-16* I,-0.0466978212678619 - 1.71565012028527e-17* I,0.000850437137098729 + 2.49956428277759e-18* I,0.450159520232262 + 2.20514566223259e-16* I,0.279339952619766 + 1.36837111539908e-16* I,0.000326317420375433 + 1.59849433747518e-19* I,-0.0317411280189047 - 1.94358354148390e-17* I,-0.321181032888462 - 1.96666661936848e-16* I,-0.00740638306093260 - 4.53510165441514e-18* I,7.24951374768224e-06 + 5.32685628388427e-21* I,0.0750384262275594 + 5.51373410955812e-17* I,0.0215829278579030 + 1.58588781104455e-17* I,-0.00163929829416277 - 1.40529298615590e-18* I,-0.0132795451516018 - 1.13839267248293e-17* I,0.00141354614666289 + 1.38487581116623e-18* I,-3.85185023227107e-06 - 4.24544045197118e-21* I,7.87238209884734e-06 + 1.54254200624293e-20* I,-0.000201338779347821 + 2.96131919618674e-19* I,-1.49249207858108e-05 + 2.19517842353833e-20* I,0.000629404022618545 + 1.38743571900648e-18* I,0.00547712475663741 + 1.20735779431441e-17* I,-0.000413414795869544 - 2.43068990261966e-18* I,-0.0514547938024043 - 3.02530651990374e-16* I,-0.00285447334763709 - 1.67829976399486e-17* I,4.80872240411412e-05 + 1.17779730003731e-19* I,0.0836282485508632 + 2.04830133812228e-16* I,0.130662728362440 + 3.20031384113844e-16* I,-1.79464484994664e-07 + 1.76046655769809e-22* I,-0.0286978137331712 + 2.81512753667105e-17* I,-0.559265327982853 + 5.48614343848109e-16* I,-0.0317411280189047 - 3.88716708296781e-18* I,0.00126439538311483 + 1.23906326153427e-17* I,0.486408393470922 + 4.76663216664870e-15* I,0.450159520232262 + 1.10257283111630e-16* I,0.000488398376286345 + 1.19623101645567e-19* I,0.00951359636030762 + 2.79619087944735e-17* I,0.599954886383262 + 2.93893132496830e-16* I,0.126361913859181 + 6.18994853367118e-17* I,-9.94998243786518e-05 + 4.88640335056845e-20* I,-0.276974176706001 - 1.69597769474739e-16* I,-0.755879612196365 - 4.62842773808510e-16* I,-0.00582492306199872 - 3.56673669157816e-18* I,0.0195296831581390 + 1.43501783807861e-17* I,0.869099433531514 + 6.38603903649088e-16* I,0.132207503503760 + 9.71444975934852e-17* I,7.35298641223414e-06 + 5.40288676434991e-21* I,-4.46048125506071e-06 - 3.82375986416681e-21* I,-0.203050140106237 - 1.74065292903267e-16* I,-0.385265653547740 - 3.30270044607057e-16* I,-0.00197022104394127 - 1.68897742655281e-18* I,0.00443585726726523 + 4.34588672306471e-18* I,0.237046274506042 + 2.32238369058903e-16* I,0.0169383562253874 + 1.65948029873906e-17* I,-0.0252324792817465 - 2.78107874882485e-17* I,-0.0257878277490795 - 2.84228826388862e-17* I,6.87573811520913e-05 + 8.42035067456632e-20* I,0.00824921604318733 + 1.01023760227644e-17* I,-0.000322545815159255 - 1.58041809968061e-18* I,7.61703953885459e-08 + 1.67907295624268e-22* I,-2.79528959846871e-05 - 1.64350242656523e-19* I,0.000262603202041203 + 6.43192341651211e-19* I,0.000333968948901229 + 8.17988008572993e-19* I,-0.000426802718030290 + 4.18674431238756e-19* I,-0.0152873363094784 + 1.49961951134346e-17* I,0.000146461334717478 + 1.43526986500567e-18* I,0.0654331748789832 + 6.41222232861729e-16* I,0.0195296831581390 + 4.78339279359538e-18* I,-6.45293182064123e-06 - 4.11013124358672e-20* I,-0.0569090266821689 - 3.62476429489456e-16* I,-0.276974176706001 - 1.01758661684843e-16* I,-0.00132158100480230 - 4.85540984203523e-19* I,-3.62070315977368e-05 + 1.77811530440528e-20* I,-0.0638624221038428 - 3.91044554076341e-17* I,-0.0724883484577099 - 4.43863119571062e-17* I,3.78678382896057e-07 - 1.48492884080988e-21* I,0.0294826197537850 + 2.16634775471708e-17* I,0.433615343797578 + 3.18615385705730e-16* I,0.0146471807946388 + 1.07625738460122e-17* I,-0.00207884442264987 - 1.78209511768645e-18* I,-0.498564643872347 - 4.27395916700416e-16* I,-0.332445113114156 - 2.84989490567201e-16* I,-0.000117163087711383 - 1.00438380240776e-19* I,4.74797594222766e-07 + 4.65167483206219e-22* I,0.116481057154694 + 1.14118523044636e-16* I,0.968777719708134 + 9.49128426820670e-16* I,0.0313936634777442 + 3.07569195932228e-17* I,-0.00254465888872594 - 2.80467752670008e-18* I,-0.596069613697903 - 6.56977270035723e-16* I,-0.269897155368022 - 2.97475818678382e-16* I,-0.000184886916116286 - 2.03779053023432e-19* I,0.0634488528007962 + 7.77024344920666e-17* I,0.410905359409392 + 5.03213933153204e-16* I,0.00731947521515640 + 8.96377189367967e-18* I,4.75415128884986e-10 + 5.82215615855225e-25* I,-0.000172895295265068 - 8.47156717415862e-19* I,-0.131443684053326 - 6.44051069966629e-16* I,-0.0290913685039117 - 1.42542619272118e-16* I,-8.37188002594078e-07 - 4.10207483697119e-21* I,0.00513947143565589 + 7.55284469158229e-18* I,0.0237204599620804 + 3.48590224402377e-17* I,1.07488574616727e-05 + 1.57962646619144e-20* I,-0.00365724618370712 + 7.17066326125518e-18* I,-2.17747738000455e-05 + 4.26932075849100e-20* I,3.12098468304085e-05 + 5.35094546318344e-20* I,9.39659743205676e-06 + 1.61105181552624e-20* I,-5.97984471715455e-07 - 3.22294726621302e-21* I,-1.27102557514210e-06 + 1.24681940222500e-21* I,5.81808443242189e-05 + 5.70151929450989e-19* I,-0.000249026860154384 - 1.58615201099572e-18* I,-0.00207884442264987 - 7.63755050437048e-19* I,0.000216585489781186 + 6.36577744325499e-19* I,0.0294826197537850 + 1.44423183647805e-17* I,0.000758133692862226 + 3.71378400115795e-19* I,0.000174022253178513 + 1.27869477201285e-19* I,0.00700267851343825 + 5.14548469616406e-18* I,-8.03388244626297e-05 - 6.88706789577944e-20* I,-0.0418890610106800 - 3.59095131402122e-17* I,-0.00783093843607919 - 6.71309358304505e-18* I,5.66475837463337e-06 + 5.54986256915034e-21* I,0.0481634358277828 + 4.71865580179466e-17* I,0.177737767470257 + 1.74132790416038e-16* I,0.000273967682363516 + 2.68410916221039e-19* I,-1.29380227727709e-09 - 1.42600573583725e-24* I,-0.0112525587010113 - 1.24023689958701e-17* I,-0.517945315733139 - 5.70870065741358e-16* I,-0.0734092058506078 - 8.09103140756063e-17* I,0.000245824722224245 + 3.01048459223209e-19* I,0.318681425042168 + 3.90272187125609e-16* I,0.631112576299052 + 7.72889996466274e-16* I,0.00263983862490100 + 3.23286992225056e-18* I,-0.0339221633902920 - 1.66212669588878e-16* I,-0.960838359479334 - 4.70793996641626e-15* I,-0.104508387033848 - 5.12072823996088e-16* I,-8.37188002594078e-07 - 4.10207483697119e-21* I,9.24363829525509e-05 + 1.35842304609121e-19* I,0.307360638788571 + 4.51689866971571e-16* I,0.415370215702838 + 6.10418166145952e-16* I,0.00147425630591790 + 2.16653191939819e-18* I,-0.0120178556685762 + 2.35630832033231e-17* I,-0.338683708526640 + 6.64047948627819e-16* I,-0.0189283301303675 + 3.71122627914416e-17* I,-8.89448970868796e-08 + 1.74391843966741e-22* I,0.0522186206537705 + 8.95291132953418e-17* I,0.0383445504297531 + 6.57419433279580e-17* I,7.04155299077279e-06 + 1.20727814636469e-20* I,-0.000445618115498973 - 2.40174077263634e-18* I,-0.0165470515289962 - 8.91833768463488e-17* I,-3.89057936702903e-05 - 2.09689928886943e-19* I,0.00105302796449048 + 2.06333972180147e-18* I,4.19414686591215e-05 + 8.21815765518915e-20* I,-9.08917369598149e-06 + 1.33684850134545e-20* I,1.70369077747721e-07 + 3.75555502327380e-22* I,5.66475837463337e-06 + 2.77493128457517e-21* I,-8.03388244626297e-05 - 4.91933421127103e-20* I,-7.32388947227454e-05 - 4.48458889976501e-20* I,-1.29197258909496e-05 - 1.10754706707488e-20* I,7.72840256836991e-05 + 7.57165077430112e-20* I,0.000684715885022589 + 6.70828093534609e-19* I,-8.88600537161848e-05 - 9.79399623200288e-20* I,-0.0155409053140596 - 1.71289079538436e-17* I,-0.000136449540345268 - 1.50392243546064e-19* I,2.07606237684480e-05 + 2.54244314463323e-20* I,0.0452877248557562 + 5.54614672852679e-17* I,0.0365614378638130 + 4.47748478521435e-17* I,-4.53539031138057e-07 - 2.22226195484288e-21* I,-0.0278646340753587 - 1.36531835057078e-16* I,-0.314325471527189 - 1.54013985314594e-15* I,-0.00574385902261076 - 2.81439049422042e-17* I,0.00296606138807727 + 4.35885310198006e-18* I,0.478545320988252 + 7.03258794714246e-16* I,0.227393233866853 + 3.34171675203368e-16* I,1.07488574616727e-05 + 1.57962646619144e-20* I,-8.08238505235043e-06 + 1.58469128538295e-20* I,-0.153080894509598 + 3.00141552173934e-16* I,-0.903777957744670 + 1.77201289505835e-15* I,-0.0189283301303675 + 3.71122627914416e-17* I,0.00598549021463478 + 1.02621560057524e-17* I,0.736920604419509 + 1.26345444319932e-15* I,0.243025368171042 + 4.16668334939183e-16* I,8.27423157603774e-05 + 1.41862157009980e-19* I,-0.113619216175268 - 6.12371657596473e-16* I,-0.492314875182438 - 2.65342154543481e-15* I,-0.00655050958614126 - 3.53051759059758e-17* I,0.000969592462661830 + 1.89985328940194e-18* I,0.212451561351833 + 4.16284999333407e-16* I,0.0361926942433903 + 7.09172274522989e-17* I,1.67689011670670e-06 + 3.28575698231470e-21* I,-0.0135200784750754 + 1.98855223280289e-17* I,-0.0390166761321591 + 5.73862781804008e-17* I,-3.39288128770399e-05 + 4.99029770628703e-20* I,0.00845533925593529 + 1.86386474798750e-17* I,9.22338351937933e-05 + 2.03316967877694e-19* I,-0.000158488373009604 - 9.31839140267796e-19* I,-5.31433304996966e-05 - 3.12458475429006e-19* I,5.16549254234663e-06 + 1.26518078160086e-20* I,-9.78550015837470e-09 + 9.59913922784233e-24* I,1.35123502036851e-07 + 9.92871385554063e-23* I,-7.87225379555160e-07 - 8.67665737151809e-22* I,1.78675496685574e-05 + 2.18814375102052e-20* I,1.07671261625492e-05 + 1.31859265909816e-20* I,-5.20677950791024e-05 - 2.55123092243020e-19* I,-0.00288503437364295 - 1.41361640052740e-17* I,3.20362760905076e-05 + 4.70797475650092e-20* I,0.0248031763205084 + 3.64501565875177e-17* I,0.00266360963163298 + 3.91437721146887e-18* I,-3.41011338145894e-06 + 6.68611668803659e-21* I,-0.0377616357852157 + 7.40382136746060e-17* I,-0.105449455759904 + 2.06751883891624e-16* I,-2.17747738000455e-05 + 4.26932075849100e-20* I,9.29240693800702e-09 + 1.59318829782069e-23* I,0.0120794932697469 + 2.07103578753645e-17* I,0.419110508045180 + 7.18567279033171e-16* I,0.0383445504297531 + 6.57419433279580e-17* I,-0.000472310336279644 - 2.54560340463317e-18* I,-0.341733460371111 - 1.84183532177182e-15* I,-0.492314875182438 - 2.65342154543481e-15* I,-0.000958366774565845 - 5.16529395362984e-18* I,0.0526888346931389 + 1.03240340412410e-16* I,0.997319490347672 + 1.95418259453047e-15* I,0.0758715862148865 + 1.48665432326869e-16* I,-0.000449630781698906 + 6.61323302621797e-19* I,-0.430379201547504 + 6.33007806697990e-16* I,-0.419203587984369 + 6.16570556466873e-16* I,-0.000959169525497579 + 1.41076008181533e-18* I,0.0273886458726765 + 6.03745515017165e-17* I,0.451912491394922 + 9.96179734946695e-16* I,0.0194070458306951 + 4.27801978034401e-17* I,6.77536334077475e-08 + 1.49353686510122e-22* I,-0.0979343657003504 - 5.75809274863061e-16* I,-0.0527571145278128 - 3.10187702170604e-16* I,-1.37461746507395e-05 - 8.08212194073054e-20* I,0.00183569905497059 + 4.49616594373511e-18* I,0.0303976167495480 + 7.44526881080839e-17* I,0.000108367728103450 + 2.65424382705520e-19* I,-0.00295462593609555 + 2.89835626873934e-18* I,-0.000154586732418212 + 1.51642690025370e-19* I,5.59723827468084e-06 + 5.48509778256652e-20* I,4.60607542646904e-05 + 4.51379285072513e-19* I,-1.59038462129175e-06 - 1.01297979011368e-20* I,-6.70525865662906e-09 - 3.28545950557270e-23* I,1.79666341942090e-06 + 2.64033372688673e-21* I,-1.54462490941604e-05 + 3.02850410773885e-20* I,-0.000189080914549849 + 3.70725813703032e-19* I,2.35161668410640e-05 + 4.03185978301738e-20* I,0.00748551112635933 + 1.28339501372290e-17* I,9.39659743205676e-06 + 1.61105181552624e-20* I,-7.52253903148160e-06 - 4.05441073360028e-20* I,-0.0297512808249050 - 1.60349998597606e-16* I,-0.0165470515289962 - 8.91833768463488e-17* I,2.94132614696202e-07 + 5.76333704180072e-22* I,0.0242585379073136 + 4.75330252802981e-17* I,0.212451561351833 + 4.16284999333407e-16* I,0.00180846470621187 + 3.54356882213333e-18* I,-0.00374020762353109 + 5.50115018535623e-18* I,-0.430379201547504 + 6.33007806697990e-16* I,-0.143171789251659 + 2.10579089252798e-16* I,3.19178149844997e-05 + 7.03584899217809e-20* I,0.185724092346873 + 4.09403547390862e-16* I,0.791048806893950 + 1.74375970079762e-15* I,0.0100518749339624 + 2.21579936339518e-17* I,-0.0118191849815756 - 6.94914015631295e-17* I,-0.852771415572321 - 5.01390586351535e-15* I,-0.203381354747092 - 1.19578933870780e-15* I,-2.60163071357690e-05 - 1.52963986026084e-19* I,0.184804866565376 + 4.52641376612282e-16* I,0.552882366477606 + 1.35417124082363e-15* I,0.00527831030851648 + 1.29281316484624e-17* I,-0.00346401507256418 + 3.39804429316066e-18* I,-0.318559997721433 + 3.12493150177115e-16* I,-0.0416114672548684 + 4.08189935301812e-17* I,-1.93364294272722e-06 + 1.89681748748306e-21* I,0.0309637969063571 + 3.03434382129433e-16* I,0.0593588226553654 + 5.81695705175727e-16* I,6.66757281640723e-05 + 6.53398820554258e-19* I,-5.86577634266396e-05 - 3.73614835612493e-19* I,-0.0176865899226939 - 1.12652989144005e-16* I,-0.000246324812129266 - 1.56894158274637e-18* I,0.000610682153716030 + 1.79488786762740e-18* I,0.000188273445800349 + 5.53364334633217e-19* I,-2.67299567801610e-05 + 1.31269930561960e-20* I,1.82906476392528e-07 - 7.17239521012553e-22* I,4.67474687477348e-08 + 8.01487931582161e-23* I,-1.85068227680932e-06 - 9.97459242973405e-21* I,-5.97984471715455e-07 - 3.22294726621302e-21* I,7.35556559940724e-06 + 1.44127517875719e-20* I,0.00105302796449048 + 2.06333972180147e-18* I,-5.99756588541838e-06 + 8.82130459140305e-21* I,-0.0135200784750754 + 1.98855223280289e-17* I,-0.000725783858582339 + 1.06749314745243e-18* I,9.24711197887523e-07 + 2.03840029553161e-21* I,0.0273886458726765 + 6.03745515017165e-17* I,0.0574585576850250 + 1.26659589754661e-16* I,-7.89120923196355e-09 - 4.63967008225935e-23* I,-0.0118191849815756 - 6.94914015631295e-17* I,-0.317468432434635 - 1.86656917175955e-15* I,-0.0176770610701794 - 1.03933033555080e-16* I,0.000752154079007696 + 1.84224617064480e-18* I,0.342239318443348 + 8.38244571748036e-16* I,0.357663087933284 + 8.76021911621310e-16* I,0.000247357802426852 + 6.05851881972336e-19* I,-0.0741669929636430 + 7.27545122932847e-17* I,-0.972289788826228 + 9.53772919288629e-16* I,-0.0501851101168224 + 4.92293547983540e-17* I,0.00139019922087352 + 1.36234662337541e-17* I,0.560214345207555 + 5.48990468488699e-15* I,0.395633440295982 + 3.87706936810796e-15* I,0.000528440847388647 + 5.17853551695424e-18* I,-0.0544524213118662 - 3.46829324008895e-16* I,-0.564371716940928 - 3.59470995707047e-15* I,-0.0182216569112718 - 1.16061045525651e-16* I,-1.94168601135408e-08 - 1.23673774376073e-22* I,0.000103154572967225 + 3.03187002244138e-19* I,0.168160530734493 + 4.94249413696599e-16* I,0.0673175432641401 + 1.97856513323742e-16* I,1.86958535799253e-05 + 5.49499613855594e-20* I,-0.00580624278212073 + 2.85142655898556e-18* I,-0.0514528184294428 + 2.52683083553023e-17* I,-0.000217925078980449 + 1.07022282979168e-19* I,0.00730496861620580 - 2.86453071243638e-17* I,0.000413052908714673 - 1.61972323912449e-18* I,-4.99860916625156e-05 - 3.42867600921437e-19* I,-0.000166525891535855 - 1.14224439285415e-18* I,9.53270187036671e-06 + 3.26877399317576e-20* I,-2.22571948349164e-05 + 4.36390774053821e-20* I,0.000388808887907568 + 6.66614984078464e-19* I,-0.000964406439161806 - 5.19784583652833e-18* I,0.000508817018327232 + 9.96993812553832e-19* I,-4.36515545531754e-05 + 6.42033228076735e-20* I,4.53349789499687e-08 + 9.99348063488853e-23* I,4.12496777009548e-05 + 9.09293143722016e-20* I,-0.00326563750025878 - 1.92004547897214e-17* I,0.0180432099216634 + 4.41931185538178e-17* I,0.00659311561766006 + 1.61484758751516e-17* I,-0.0194510547671280 + 1.90806172210067e-17* I,-0.133399668731785 + 1.30859125479503e-16* I,-0.000405552976368761 + 3.97829382394714e-19* I,0.00421525571232055 + 4.13080319721044e-17* I,0.362640541103055 + 3.55375049311531e-15* I,0.0822804883354750 + 8.06320013494759e-16* I,-7.90114978764652e-05 - 5.03255938619812e-19* I,-0.208946381638973 - 1.33086335836011e-15* I,-0.648656794687103 - 4.13155544225687e-15* I,-0.00456975587704583 - 2.91066091008904e-17* I,0.0203094342405316 + 5.96925207243858e-17* I,0.925309924886745 + 2.71962681055639e-15* I,0.157573972888883 + 4.63133907665527e-16* I,3.93938357052286e-06 + 1.15784483526108e-20* I,-3.84741571782308e-05 + 1.88945308918898e-20* I,-0.275705892751417 + 1.35398248843647e-16* I,-0.582136563590334 + 2.85885334228442e-16* I,-0.00379310238622449 + 1.86277999231054e-18* I,0.00951956646892119 - 3.73295108466433e-17* I,0.444944444719641 - 1.74478097606033e-15* I,0.0442136612573002 - 1.73377049560246e-16* I,-0.0631705959720989 - 4.33303544433202e-16* I,-0.0838021097557640 - 5.74820462421961e-16* I,0.000432260748339417 + 1.48222687718254e-18* I,0.0337855532432628 + 1.15851034982996e-16* I,-0.00193403922731187 + 2.39426566421672e-21* I,0.00260815252674405 + 4.47169190099126e-18* I,-0.0455615764222823 - 2.45562493877640e-16* I,-9.39206767071359e-07 - 5.06202757014362e-21* I,0.113011505257713 + 2.21438685089092e-16* I,0.000137255699123389 + 2.68943604153905e-19* I,-0.0596244226571929 + 8.76964427559534e-17* I,-0.000966765627128740 + 1.42193253535330e-18* I,0.00511519592422160 + 1.12757549680972e-17* I,0.00126485368376403 + 2.78819822738044e-18* I,-5.31246371230742e-06 - 3.12348566924870e-20* I,-0.000342373306436213 - 2.01299843932924e-18* I,9.92906633339621e-06 + 2.43191986074308e-20* I,-0.000333265603637900 + 3.26918693719837e-19* I,0.00674302161574598 + 6.60792539056868e-17* I,0.000140470889902161 + 1.37656560057991e-18* I,-0.0183305778091568 - 1.16754806436071e-16* I,-0.0284993924136784 - 1.81524067568806e-16* I,0.0105617201400726 + 3.10425042312721e-17* I,0.224674463017452 + 6.60352468762736e-16* I,0.00698755878169255 + 2.05374995900490e-17* I,-0.00102659141052909 + 5.04155634384258e-19* I,-0.320498470379751 + 1.57395735047316e-16* I,-0.240944467855839 + 1.18327028452958e-16* I,-3.10560616689568e-05 + 1.52515288084479e-20* I,1.94477299656595e-06 - 7.62612718831037e-21* I,0.0954959138823979 - 3.74472489343002e-16* I,0.890138021921989 - 3.49053888670543e-15* I,0.0299028565039226 - 1.17259437165871e-16* I,-0.00329728062988305 - 2.26169052536769e-17* I,-0.680359202049091 - 4.66676068507924e-15* I,-0.348557627363724 - 2.39084740379268e-15* I,0.0965933989705693 + 3.31219831230598e-16* I,0.660652470614398 + 2.26538461376280e-15* I,-0.000660964714376097 + 8.18248719333917e-22* I,-0.266347819718233 + 3.29728286006227e-19* I,0.0152469645157217 + 1.64352637663057e-16* I,-0.0169161643701330 - 9.11727783752102e-17* I,0.295506918333438 + 5.79026562660709e-16* I,8.86402278508949e-05 + 1.73684754101265e-19* I,-0.732979064319590 + 1.07807595764889e-15* I,-0.0129538849917663 + 1.90527569579845e-17* I,0.386716851794895 + 8.52464798508526e-16* I,0.0912411712431730 + 2.01128774964133e-16* I,1.84420016202296e-05 + 4.06528888573521e-20* I,-0.0331765470586140 - 1.95062921658483e-16* I,-0.119374053358337 - 7.01864831718435e-16* I,-0.000534117655192411 - 3.14036750560993e-18* I,3.44560022645402e-05 + 8.43928657693663e-20* I,0.0323124246508590 + 7.91426148427291e-17* I,0.00179257817986640 + 4.39055026038954e-18* I,-0.000937083007699432 + 9.19236637204871e-19* I,-0.00125662546688937 + 1.23269353826539e-18* I,0.000159399790331847 + 1.56206220565201e-18* I,-7.85666938898870e-07 - 5.00422803521965e-21* I,-6.28614468489872e-06 - 4.00389782338370e-20* I,0.00127536249160853 + 3.74848462344235e-18* I,-0.0100542979581986 + 4.93763235637388e-18* I,-0.00224578082753287 + 1.10289551050238e-18* I,0.0143424716501696 - 5.62417892433030e-17* I,0.0774388428514491 - 3.03664471865626e-16* I,4.43015201961190e-05 - 1.73721574830416e-19* I,-0.00427349133973235 - 2.93129883629479e-17* I,-0.286087740503589 - 1.96235020536838e-15* I,-0.0426564712374450 - 2.92591828457048e-16* I,0.000147555006739086 + 5.05967746763327e-19* I,0.218665445191046 + 7.49806225104569e-16* I,0.497217996691467 + 1.70496599875466e-15* I,-0.0310448341476123 + 3.84323024069381e-20* I,-0.942421775224497 + 1.16668166072638e-18* I,0.000212432113932360 + 2.28988387905812e-18* I,0.379945578425816 + 4.09557311675442e-15* I,-0.0217498185578998 - 1.59841999506879e-16* I,0.0207464093087140 + 4.06512380059479e-17* I,-0.362417114610598 + 5.33048209589531e-16* I,-0.000527409485773396 + 7.75721318829303e-19* I,0.898943953863508 + 1.98159990428126e-15* I,0.0770756347080648 + 1.69902772807468e-16* I,-0.474279270310204 - 2.78854517274852e-15* I,-0.542885102773779 - 3.19191608713313e-15* I,-0.00142511987841813 - 8.37905303124804e-18* I,0.0406885514746511 + 9.96582086507476e-17* I,0.710275792637989 + 1.73967395193192e-15* I,0.0412743531588144 + 1.01093008965639e-16* I,2.68222472364453e-07 + 6.56955584481034e-22* I,-4.22577075086973e-05 + 4.14529263972539e-20* I,-0.192258974084182 + 1.88597478939975e-16* I,-0.138522859413694 + 1.35884747047179e-16* I,-0.000141587160417409 + 1.38890689665810e-19* I,0.00557564527078047 + 5.46393739381754e-17* I,0.0971067007512935 + 9.51611710676444e-16* I,0.00145666907829039 + 1.42748475929755e-17* I,-0.0123177415605697 - 7.84566393163803e-17* I,-0.00252814745398199 - 1.61027857225571e-17* I,6.07130177893759e-05 + 1.78444806965605e-19* I,0.000929995393897403 + 2.73339811765977e-18* I,-4.59638859237734e-05 + 2.25727118199076e-20* I,8.85255308757436e-05 - 3.47139208053182e-19* I,-0.00305253058970978 - 2.09381010841850e-17* I,-1.32001071721033e-05 - 9.05429676031037e-20* I,0.0112771775387113 + 3.86695662533579e-17* I,0.0127099474109546 + 4.35825499596390e-17* I,-0.00861948520639194 + 1.06705888802328e-20* I,-0.148151368512200 + 1.83405656786235e-19* I,0.00122374382672326 + 1.31911847462137e-17* I,0.280804549803621 + 3.02689550962254e-15* I,-8.37377602941684e-06 - 6.15398744776477e-20* I,-0.113208809372346 - 8.31984984320541e-16* I,0.00648058880749718 + 2.53965834870130e-17* I,-0.00521985855420324 + 7.67744166722988e-18* I,0.0911852286214753 + 2.01005457049457e-16* I,0.000603806190926571 + 1.33100877424244e-18* I,-0.226176984050576 - 1.32981721222717e-15* I,-0.0882402510036005 - 5.18812314561566e-16* I,0.119330081141807 + 2.92274403824617e-16* I,0.621523493336362 + 1.52229351341851e-15* I,0.00779190292250037 + 1.90846579466140e-17* I,-0.0102373610928368 + 1.00423946518191e-17* I,-0.813161182020075 + 7.97674853053602e-16* I,-0.225669263247845 + 2.21371482530379e-16* I,-1.72096444766464e-05 + 1.68818936916183e-20* I,1.06321654382690e-05 + 1.04191503393975e-19* I,0.220108211825180 + 2.15698350750633e-15* I,0.757379564655815 + 7.42205488990316e-15* I,0.00908449121269239 + 8.90248371806635e-17* I,-0.00638329272362420 - 4.06577530796234e-17* I,-0.530934973848125 - 3.38173792158435e-15* I,-0.0934625526955813 - 5.95300506214408e-16* I,-1.19270961149305e-05 - 7.59684617005085e-20* I,0.0673477704703290 + 1.97945355686878e-16* I,0.162210565296895 + 4.76761558988939e-16* I,0.000636309415478533 + 1.87021029343946e-18* I,-0.000331950980342761 + 1.63020024678493e-19* I,-0.0596702056796569 + 2.93038399598163e-17* I,-0.00293621315858404 + 1.44196453668983e-18* I,0.00294912700095632 - 1.15645464244343e-17* I,0.00272369344641483 - 1.06805435292471e-17* I,-0.000492960814424827 - 3.38134641394390e-18* I,6.22680095773426e-06 + 2.13517692130874e-20* I,4.55772984638448e-07 + 1.56285059497087e-21* I,-0.000438848760132109 + 5.43277769825168e-22* I,0.00511536690760946 + 5.51404210990998e-17* I,-0.00969561277763920 - 7.12542097165866e-17* I,0.00390887106159588 + 1.53183565883620e-17* I,-0.000223761615303375 - 1.09334570167159e-19* I,0.000131851467800788 + 2.90648660409208e-19* I,-0.00230330115474310 - 1.35423572534470e-17* I,-0.000140368306012804 - 8.25301434496348e-19* I,0.00571313705537292 + 1.39931500159052e-17* I,0.0205134275561384 + 5.02434067923320e-17* I,-0.00301422848683609 + 2.95682371277728e-18* I,-0.144487090754913 + 1.41735391991722e-16* I,-0.00832802918317457 + 8.16942520351504e-18* I,0.000258591506356105 + 2.53410633690645e-18* I,0.189037574226212 + 1.85250212394982e-15* I,0.241196563761921 + 2.36364198222134e-15* I,8.65989897570077e-05 + 8.48639817313742e-19* I,-2.68564100804560e-07 - 1.71059253732036e-21* I,-0.0511690958087003 - 3.25916506225418e-16* I,-0.809491491350570 - 5.15597617097862e-15* I,-0.0457131907950303 - 2.91165657646797e-16* I,0.00148393971420534 + 4.36152485071010e-18* I,0.567466253180210 + 1.66786975339509e-15* I,0.470303884227924 + 1.38229475147111e-15* I,0.000643038452369659 + 1.88998795781561e-18* I,-0.0719816716759944 + 3.53499600480263e-17* I,-0.816244118330653 + 4.00854777342547e-16* I,-0.0343060387721159 + 1.68475817769147e-17* I,0.000354791054146093 - 1.39125836741381e-18* I,0.300260678683010 - 1.17742591517281e-15* I,0.158303240548197 - 6.20761728424845e-16* I,0.000123410950154885 - 4.83936996232077e-19* I,-0.0148400171365829 - 1.01791536485914e-16* I,-0.146845435102975 - 1.00725102454405e-15* I,-0.00193925272672445 - 1.33018387290915e-17* I,0.0265775303671622 + 9.11346449814829e-17* I,0.00449383830379798 + 1.54094211449695e-17* I,-0.000335712264954669 + 4.15598782944321e-22* I,-0.00221832969779134 + 2.74620625700348e-21* I,0.000172777340792837 + 1.86243049614439e-18* I,-9.81153115989652e-08 - 7.21061076738173e-22* I,3.03613213682881e-06 + 7.43637900631163e-21* I,-0.000443700422188041 + 4.35250325389892e-19* I,0.00312522044369386 + 3.06260675077553e-17* I,0.00178661434403950 + 1.75081958206458e-17* I,-0.00408883650789379 - 2.60434406377198e-17* I,-0.0517439637964648 - 3.29578071143694e-16* I,-8.64132829264818e-05 - 5.50400878064350e-19* I,0.00110677503070455 + 3.25298039694850e-18* I,0.173660427697200 + 5.10414448603046e-16* I,0.0456151613399570 + 1.34069907186164e-16* I,-3.20972531719831e-05 + 1.57628544997988e-20* I,-0.121738688156668 + 5.97854656947696e-17* I,-0.469295343089407 + 2.30469385368107e-16* I,-0.00298229870433655 + 1.46459699524783e-18* I,0.0154422474148021 - 6.05543901867129e-17* I,0.814493727147385 - 3.19391145818816e-15* I,0.159105345261975 - 6.23907058278978e-16* I,-7.61134204182361e-05 - 5.22081742916005e-19* I,-0.299616785964096 - 2.05514944622761e-15* I,-0.734182454314207 - 5.03594836837572e-15* I,-0.00564910212610203 - 3.87486604556696e-17* I,0.0148081935257634 + 5.07774590469461e-17* I,0.681043177482620 + 2.33530457267865e-15* I,0.0887687574549854 + 3.04389049108300e-16* I,5.65842317898563e-06 + 1.94027955362246e-20* I,-0.123261889061788 + 1.52593445117099e-19* I,-0.205704206024534 + 2.54653840787938e-19* I,-0.000663067867317519 + 8.20852341226965e-22* I,0.00155697415778901 + 1.67831970319062e-17* I,0.101543428654109 + 1.09457396057062e-15* I,0.00430057863452456 + 4.63575186610211e-17* I,-0.00790883501010335 - 5.81229677121040e-17* I,-0.00527433776735376 - 3.87617346123683e-17* I,4.49120126424163e-06 + 1.76004328082562e-20* I,0.00132703913737569 + 5.20049354217728e-18* I,-3.35204596590422e-05 - 1.63787924200406e-20* I,-3.27900788724280e-05 - 2.08853171549311e-19* I,0.000949666983094940 + 2.79121591464754e-18* I,1.70845950415461e-05 + 5.02142271176597e-20* I,-0.00318722344316119 + 1.56523485432550e-18* I,-0.00901848110447302 + 4.42894613745572e-18* I,0.00223429370742519 - 8.76143797705605e-18* I,0.0927834312045203 - 3.63835907112526e-16* I,0.00277835125723659 - 1.08948756995813e-17* I,-0.000283414555798345 - 1.94401413634952e-18* I,-0.161031904134824 - 1.10455970463323e-15* I,-0.148224768833144 - 1.01671223327639e-15* I,1.39692433741540e-06 + 4.79006897170706e-21* I,0.0592366275471927 + 2.03123049690270e-16* I,0.683974660894577 + 2.34535666165483e-15* I,0.0241794044327584 + 8.29114446828272e-17* I,-0.00292769793157555 + 3.62437665885011e-21* I,-0.634469366076523 + 7.85448504219715e-19* I,-0.379949882226427 + 4.70363239944371e-19* I,-0.000221910495562075 + 2.74716599617303e-22* I,0.114832502842925 + 1.23782177837591e-15* I,0.880459421684888 + 9.49079589973394e-15* I,0.0260040146120879 + 2.80306836611209e-16* I,-0.00145049893979024 - 1.06598889641988e-17* I,-0.434628295631613 - 3.19413495938296e-15* I,-0.168658918890209 - 1.23949442420925e-15* I,-9.00046080935744e-05 - 4.41006843060459e-19* I,0.0338515601298219 + 1.32659855229218e-16* I,0.206847538738710 + 8.10608563929181e-16* I,0.00230189765965407 + 3.38281392103217e-18* I,-1.92233330771710e-05 - 9.39291958686943e-21* I,-0.0520434586262421 - 2.54295142229726e-17* I,-0.00719594929171386 + 1.41089023336253e-17* I,0.00131459623628576 - 3.86705341351320e-18* I,0.00472655369303931 + 8.10370239165016e-18* I,-0.000549779177355293 - 2.96313596838887e-18* I,2.05180978715768e-06 + 4.02038766128299e-21* I,-2.63292888193747e-07 + 1.29302263504980e-22* I,0.000138984970456902 - 5.45008113460790e-19* I,-0.00142989737356708 - 9.80803791080262e-18* I,-0.000505498058580020 - 3.46734263174543e-18* I,0.00248168335438399 + 8.50971961404214e-18* I,0.0269682721662598 + 9.24745029234454e-17* I,-0.000912903274314084 + 1.13013889975706e-21* I,-0.124443539059213 + 1.54056282052360e-19* I,-0.0210294911498291 + 2.60336956381010e-20* I,4.51191287992990e-05 + 4.86355682114798e-19* I,0.115436459643039 + 1.24433205083250e-15* I,0.330452832611302 + 3.56207260841291e-15* I,0.000877671577177530 + 9.46074469854526e-18* I,-0.0208928252314354 - 1.53543853777459e-16* I,-0.765759705438443 - 5.62765901394715e-15* I,-0.102847701996837 - 7.55839975772629e-16* I,0.000263906299150103 + 1.03421441449279e-18* I,0.378008148292825 + 1.48136470034697e-15* I,0.667057855792221 + 2.61411285741453e-15* I,0.00304839065733021 + 4.47984223326016e-18* I,-0.0294416302162322 - 1.43857916843686e-17* I,-0.818096526260561 - 3.99738945094195e-16* I,-0.0779636006250295 + 1.52861114247003e-16* I,-1.64814606847642e-06 + 3.23147523266442e-21* I,1.67190599727467e-05 - 4.91812589704449e-20* I,0.205835529764252 - 6.05491607252801e-16* I,0.243721572218573 + 4.17861980620890e-16* I,0.000604834140412249 + 1.03699147169926e-18* I,-0.00519932033466988 - 4.07573549930305e-17* I,-0.160084938142842 - 8.62807210142507e-16* I,-0.00568210828899822 - 3.06247674355451e-17* I,0.0186206211364439 + 3.64858945166105e-17* I,0.00923499501543156 + 1.80953713372640e-17* I,-6.94933061570288e-05 + 1.02211735958614e-19* I,-0.00316907470109732 + 4.66111981850099e-18* I,0.000139626086435354 + 3.07786751694951e-19* I;
  for (t_int i = 0; i < 756; ++i)
  {
    CHECK(std::abs(op.G.coeffRef(k(i) - 1, l(i) - 1) - expected_values(i)) < 1e-13);
  }
  Vector<t_complex> expected_grid(400);
  expected_grid << 0.00152201456019792 - 3.72786051880411e-18 * I,-1.59182895411959e-05 - 1.56151320936083e-20 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,6.46302796167347e-06 - 2.21617942169771e-20 * I,-0.000344801911956239 - 4.26851413919111e-22 * I,0.00510661086719002 - 5.50460365193406e-17 * I,-0.0574309315598105 + 4.22066736309789e-16 * I,0.211780067776812 - 8.29938502803464e-16 * I,-0.615915993968774 + 2.73631282383021e-16 * I,0.954414511905068 + 1.47913044715445e-15 * I,-1.07666041543865 + 6.21217363913418e-15 * I,0.757377591198294 - 1.49437100689736e-15 * I,-0.342621042174006 - 5.03931866724298e-16 * I,0.104077671959141 - 2.29425098089447e-16 * I,-0.0132176139901000 + 7.77135244878814e-17 * I,-0.0539865450408986 - 3.66910531666011e-17 * I,0.00721650885244244 - 5.68917440255788e-18 * I,-0.000479901665016348 + 1.76313011390327e-19 * I,1.09607122847037e-07 - 5.36920048633496e-23 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,-3.67679926748075e-05 + 2.70212344592682e-19 * I,0.000687030193173552 - 2.69238184636025e-18 * I,-0.0141429105890794 + 6.91051969781802e-18 * I,0.0921581024528453 + 2.31742973165334e-16 * I,-0.318218299818725 + 1.96468063966380e-15 * I,0.761711055638782 - 1.55528779032398e-15 * I,-1.01300700990071 - 1.48835960854379e-15 * I,1.03645915306489 - 2.28473349164620e-15 * I,-0.586901514417475 + 3.44783208108155e-15 * I,0.255494143063723 - 6.09110108096910e-16 * I,0.460196712548672 - 1.29042376575678e-15 * I,-0.169675709441927 + 7.00752213157716e-17 * I,0.0268859401482795 - 1.31703122178631e-17 * I,-0.00373913513732723 + 2.28955993875359e-18 * I,8.16312390210630e-05 - 5.99816613465464e-20 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,-9.19343533616609e-07 + 4.49210334612796e-22 * I,0.000107730923772406 + 3.16904327744063e-19 * I,-0.00188536531613567 + 1.18729175872276e-17 * I,0.0313218601168556 - 6.34720424699002e-17 * I,-0.137777002503429 - 2.02116271899128e-16 * I,0.467687754240316 - 1.03100619699070e-15 * I,-0.857113196412749 + 5.03943354891427e-15 * I,1.08235065377448 - 2.62431617437214e-15 * I,-0.901675599539881 - 7.14024308115445e-16 * I,-1.10310405063058 + 8.93320284903005e-16 * I,0.730676227409502 - 3.60011091479692e-16 * I,-0.360328543968300 + 2.20637599006102e-16 * I,0.0966286035992101 - 7.10015460623106e-17 * I,-0.0149188434457645 + 1.27892197109852e-17 * I,0.00141354614666289 - 1.38487581116623e-18 * I,-3.85185023227107e-06 + 4.24544045197118e-21 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,7.87238209884734e-06 - 1.54254200624293e-20 * I,-0.000216263700133632 - 3.18083703854058e-19 * I,0.00610652877925595 - 1.34610136621506e-17 * I,-0.0547226819459110 + 3.21744339532942e-16 * I,0.214339064137344 - 5.24979297656076e-16 * I,-0.619704449199414 - 5.72878628178508e-16 * I,0.938320707462585 - 4.88939970547732e-15 * I,0.735830396602751 - 3.83754526628016e-16 * I,-1.03877821178874 + 6.35958415941322e-16 * I,1.02084397317983 - 7.50103982510123e-16 * I,-0.590290475179173 + 5.06028138696741e-16 * I,0.258420487998695 - 2.53179058769359e-16 * I,-0.0510203070308261 + 5.62336701271347e-17 * I,0.00831797342433942 - 1.01865795295100e-17 * I,-0.000322545815159255 + 1.58041809968061e-18 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,7.61703953885459e-08 - 1.67907295624268e-22 * I,-2.79528959846871e-05 + 1.64350242656523e-19 * I,0.000596572150942433 - 1.46118035022420e-18 * I,-0.0157141390275087 - 1.54148695446734e-17 * I,0.0851093193718397 - 6.47440895520330e-16 * I,-0.335211237324793 + 4.64761733470939e-16 * I,-0.136386977593150 + 8.34729862116963e-17 * I,0.477745523024385 - 3.51039952170072e-16 * I,-0.833205764496863 + 7.14267940765545e-16 * I,1.11665291513817 - 1.09400433462601e-15 * I,-0.868696314870767 + 9.57461545293828e-16 * I,0.481673687900759 - 5.89880140121166e-16 * I,-0.160708785040505 + 7.87444948031000e-16 * I,0.0288706802551980 - 4.24276633964819e-17 * I,-0.00367902095750717 - 7.21335646884009e-18 * I,4.06064442624652e-05 - 6.96199727870968e-20 * I,-5.97984471715455e-07 + 3.22294726621302e-21 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,-1.27102557514210e-06 - 1.24681940222500e-21 * I,5.81808443242189e-05 - 5.70151929450989e-19 * I,-0.00232787128280426 + 2.34990706143277e-18 * I,0.0304573389364284 - 1.54502745092218e-17 * I,0.00717670076661676 - 5.27335417336534e-18 * I,-0.0498003382712218 + 4.26914774022150e-17 * I,0.226180835738778 - 2.21593309212775e-16 * I,-0.602607081578560 + 6.64182750238841e-16 * I,0.952679664688346 - 1.16669610197336e-15 * I,-1.09926974709148 + 5.38622956207606e-15 * I,0.724297547180279 - 1.06441040734153e-15 * I,-0.369629983270480 - 7.24723469014427e-16 * I,0.0905702126365144 - 1.55283129404763e-16 * I,-0.0170315754381655 + 9.17948075478721e-17 * I,0.00109496943314960 - 2.14552129835336e-18 * I,-9.08917369598149e-06 - 1.33684850134545e-20 * I,1.70369077747721e-07 - 3.75555502327380e-22 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,5.66475837463337e-06 - 2.77493128457517e-21 * I,-0.000153577719185375 + 9.40392311103603e-20 * I,-1.29197258909496e-05 + 1.10754706707488e-20 * I,0.000761999910706288 - 7.46544601277620e-19 * I,-0.0157662149081210 + 1.73772401597097e-17 * I,0.0818699233433377 - 1.00261739568858e-16 * I,-0.347934418164190 + 1.70481781540718e-15 * I,0.708915365100643 - 1.04180511928426e-15 * I,-1.07579526476969 - 2.10928255693657e-15 * I,0.986014205120946 - 1.69052679630126e-15 * I,-0.612484600943847 + 3.30109837893726e-15 * I,0.249615524948001 - 4.89105365832090e-16 * I,-0.0525706834201115 - 7.73217034854926e-17 * I,0.00854757309112908 - 1.88419644477527e-17 * I,-0.000211631703509301 + 1.24429761569680e-18 * I,5.16549254234663e-06 - 1.26518078160086e-20 * I,-9.78550015837470e-09 - 9.59913922784233e-24 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,1.35123502036851e-07 - 9.92871385554063e-23 * I,0.00000000000000 + 0.00000000000000 * I,-7.87225379555160e-07 + 8.67665737151809e-22 * I,2.86346758311066e-05 - 3.50673641011867e-20 * I,-0.00293710216872205 + 1.43912870975171e-17 * I,0.0274988222282319 - 4.04116135465516e-17 * I,-0.143236276432301 - 2.80839476890503e-16 * I,0.469534561037087 - 8.05019596168377e-16 * I,-0.835479012664394 + 4.50296776456489e-15 * I,1.12587991125570 - 2.20608836726975e-15 * I,-0.850991589839069 - 1.25165044654930e-15 * I,0.498708250851927 - 1.09933463360554e-15 * I,-0.150705226402814 + 8.86077798253072e-16 * I,0.0323416835326221 - 7.92142784345245e-17 * I,-0.00310921266851376 - 3.04999895876471e-18 * I,5.16579925393712e-05 - 5.06230262898178e-19 * I,-1.59038462129175e-06 + 1.01297979011368e-20 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,-6.70525865662906e-09 + 3.28545950557270e-23 * I,1.79666341942090e-06 - 2.64033372688673e-21 * I,-0.000204527163644009 - 4.01010854780421e-19 * I,0.00751842389063245 - 1.28903792532144e-17 * I,-0.0463058548929327 + 2.49573919551291e-16 * I,0.238518858097973 - 4.67362169769542e-16 * I,-0.577291198422695 - 8.49088046136144e-16 * I,0.986856691989770 - 2.17539160031235e-15 * I,-1.06799797160812 + 6.27933956777230e-15 * I,0.742965543351498 - 1.81974074908437e-15 * I,-0.363637413691808 - 3.56712084817944e-16 * I,0.0903892952898866 - 8.85783486125714e-16 * I,-0.0179915724982498 + 1.14595545562364e-16 * I,0.000798955599516380 - 2.34825220226061e-18 * I,-2.67299567801610e-05 - 1.31269930561960e-20 * I,1.82906476392528e-07 + 7.17239521012553e-22 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,4.67474687477348e-08 - 8.01487931582161e-23 * I,-2.44866674852478e-06 + 1.31975396959471e-20 * I,0.00106038353008989 - 2.07775247358904e-18 * I,-0.0142518598995431 - 2.09618367800728e-17 * I,0.0848481282688993 - 1.87036179656673e-16 * I,-0.346964686377599 + 2.03999365327446e-15 * I,0.700901918258067 - 1.71671458142196e-15 * I,-1.09664189190669 - 1.07575678638027e-15 * I,0.957766425571799 - 9.38577605474566e-15 * I,-0.637045814580926 + 4.05760045027879e-15 * I,0.235599924425180 - 6.92464063983971e-16 * I,-0.0574769862905440 - 2.82267571972670e-17 * I,0.00771802152492047 + 3.02650303634883e-17 * I,-0.000216511983198370 + 1.48511199377558e-18 * I,9.53270187036671e-06 - 3.26877399317576e-20 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,-2.22571948349164e-05 - 4.36390774053821e-20 * I,0.000388808887907568 - 6.66614984078464e-19 * I,-0.000964406439161806 + 5.19784583652833e-18 * I,0.000508817018327232 - 9.96993812553832e-19 * I,-4.36515545531754e-05 - 6.42033228076735e-20 * I,4.12950126799047e-05 - 9.10292491785504e-20 * I,-0.00326563750025878 + 1.92004547897214e-17 * I,0.0246363255393235 - 6.03415944289694e-17 * I,-0.153256276475282 - 1.50337572082904e-16 * I,0.449136285150851 - 4.40137853858217e-15 * I,-0.862251943700999 + 5.49202866565648e-15 * I,1.10319727139973 - 3.24246481739466e-15 * I,-0.861674032885154 - 4.23165257595292e-16 * I,0.498677672445863 + 1.95548753646722e-15 * I,-0.146972705727863 + 1.00812400685516e-15 * I,0.0342178139916022 - 1.17333261860178e-16 * I,-0.00193403922731187 - 2.39426566421672e-21 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00260815252674405 - 4.47169190099126e-18 * I,-0.0455625156290494 + 2.45567555905210e-16 * I,0.113148760956837 - 2.21707628693246e-16 * I,-0.0605911882843217 - 8.91183752913067e-17 * I,0.00638004960798563 - 1.40639531954777e-17 * I,-0.000347685770148521 + 2.04423329602173e-18 * I,9.92906633339621e-06 - 2.43191986074308e-20 * I,-0.000333265603637900 - 3.26918693719837e-19 * I,0.00688349250564814 - 6.74558195062667e-17 * I,-0.0468299702228352 + 2.98278874004877e-16 * I,0.242223741939217 - 7.11932472584057e-16 * I,-0.562500585707788 - 2.76242170663467e-16 * I,1.01553873708131 + 3.98227843934149e-15 * I,-1.03221411004270 + 7.08022499412559e-15 * I,0.757245869584968 - 2.59660444499340e-15 * I,-0.267008784432610 - 3.30546534725561e-19 * I,0.0152469645157217 - 1.64352637663057e-16 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,-0.0169161643701330 + 9.11727783752102e-17 * I,0.295595558561289 - 5.79200247414811e-16 * I,-0.745932949311356 - 1.09712871460687e-15 * I,0.477976465039688 - 1.05363422636152e-15 * I,-0.153084718072143 + 9.00068120882529e-16 * I,0.0341394588329900 - 8.36175579688880e-17 * I,-0.00219370847458881 - 2.15193017547026e-18 * I,0.000159399790331847 - 1.56206220565201e-18 * I,-7.07181162379759e-06 + 4.50432062690567e-20 * I,0.00127536249160853 - 3.74848462344235e-18 * I,-0.0123000787857314 - 6.04052786687626e-18 * I,0.0918256160218148 + 3.60079982683759e-16 * I,-0.333017703080767 + 2.28425502218838e-15 * I,0.716030996889253 - 2.45527819160599e-15 * I,-0.973466609372109 - 1.20511396313332e-18 * I,0.380158010539748 - 4.09786300063348e-15 * I,-0.0217498185578998 + 1.59841999506879e-16 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.0207464093087140 - 4.06512380059479e-17 * I,-0.362944524096372 - 5.33823930908360e-16 * I,0.976019588571573 - 2.15150267708873e-15 * I,-1.01858949296240 + 5.98884031291290e-15 * I,0.792238965493927 - 1.94042582650390e-15 * I,-0.330965678365802 - 3.24662569603217e-16 * I,0.104139015100364 - 1.02052593220760e-15 * I,-0.0148458890145517 + 9.45594250389374e-17 * I,0.000990708411686779 - 2.91184292462537e-18 * I,-4.59638859237734e-05 - 2.25727118199076e-20 * I,8.85255308757436e-05 + 3.47139208053182e-19 * I,-0.00306573069688188 + 2.10286440517881e-17 * I,0.0239871249496660 - 8.22521162129969e-17 * I,-0.156770853718592 - 1.94076245666468e-19 * I,0.282028293630344 - 3.04008669436875e-15 * I,-0.113217183148375 + 8.32046524195019e-16 * I,0.00648058880749718 - 2.53965834870130e-17 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,-0.00521985855420324 - 7.67744166722988e-18 * I,0.0917890348124018 - 2.02336465823699e-16 * I,-0.314417235054176 + 1.84862952678873e-15 * I,0.748645477400669 - 1.83365257518974e-15 * I,-1.04908501600523 - 1.02910561212949e-15 * I,0.986582899859126 - 9.66816742609355e-15 * I,-0.630792746363445 + 4.01777214934008e-15 * I,0.230194645182702 - 6.76577124969257e-16 * I,-0.0629383698185837 - 3.09088245211846e-17 * I,0.00567282044737115 + 2.22450899536814e-17 * I,-0.000492960814424827 + 3.38134641394390e-18 * I,6.68257394237271e-06 - 2.29146198080583e-20 * I,-0.000438848760132109 - 5.43277769825168e-22 * I,0.00511536690760946 - 5.51404210990998e-17 * I,-0.00969561277763920 + 7.12542097165866e-17 * I,0.00390887106159588 - 1.53183565883620e-17 * I,-0.000223761615303375 + 1.09334570167159e-19 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.000131851467800788 - 2.90648660409208e-19 * I,-0.00244366946075590 + 1.43676586879434e-17 * I,0.0262265646115113 - 6.42365568082372e-17 * I,-0.155829348424924 - 1.52861640908015e-16 * I,0.430579328484246 - 4.21952685232538e-15 * I,-0.906374046518401 + 5.77306004544337e-15 * I,1.03989711557471 - 3.05641601767472e-15 * I,-0.922531828778763 - 4.53052319167488e-16 * I,0.459042121235508 + 1.80006283896130e-15 * I,-0.163624704966283 + 1.12234439975906e-15 * I,0.0310713686709602 - 1.06544066126452e-16 * I,-0.00255404196274601 - 3.16180503994780e-21 * I,0.000172777340792837 - 1.86243049614439e-18 * I,-9.81153115989652e-08 + 7.21061076738173e-22 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,3.03613213682881e-06 - 7.43637900631163e-21 * I,-0.000443700422188041 - 4.35250325389892e-19 * I,0.00491183478773336 - 4.81342633284011e-17 * I,-0.0559192135872851 + 3.56171912659478e-16 * I,0.220382364067861 - 6.47737336186159e-16 * I,-0.594048427203583 - 2.91735210912625e-16 * I,0.989041319824161 + 3.87837290665385e-15 * I,-1.03952445582482 + 7.13036855680191e-15 * I,0.784625786886548 - 2.69049048362944e-15 * I,-0.329629162953640 - 4.08068138246263e-19 * I,0.107400981446423 - 1.15771467626355e-15 * I,-0.0131831727774571 + 9.68847023244723e-17 * I,0.00133153033863993 - 5.21809397498554e-18 * I,-3.35204596590422e-05 + 1.63787924200406e-20 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,-3.27900788724280e-05 + 2.08853171549311e-19 * I,0.000966751578136486 - 2.84143014176520e-18 * I,-0.0122057045476342 - 5.99418099178122e-18 * I,0.0977960761691821 + 3.83492220789163e-16 * I,-0.309540087523767 + 2.12321595204598e-15 * I,0.767392089798865 - 2.63139594609690e-15 * I,-1.01756885673009 - 1.25971083742255e-18 * I,1.02129593913990 - 1.10089245147211e-14 * I,-0.604827718069706 + 4.44473027939947e-15 * I,0.243000996528186 - 9.46651233079430e-16 * I,-0.0592586312510331 + 1.13300048089341e-17 * I,0.00604114992932507 - 4.23664897813696e-18 * I,-0.000549779177355293 + 2.96313596838887e-18 * I,2.05180978715768e-06 - 4.02038766128299e-21 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,0.00000000000000 + 0.00000000000000 * I,-2.63292888193747e-07 - 1.29302263504980e-22 * I,0.000138984970456902 + 5.45008113460790e-19 * I,-0.00193539543214710 + 1.32753805425481e-17 * I,0.0294499555206438 - 1.00984222537488e-16 * I,-0.146385933483356 - 1.81220116590218e-19 * I,0.446812082960318 - 4.81635175962608e-15 * I,-0.889500232666715 + 6.53704284349723e-15 * I,1.04837830104153 - 4.10099161440924e-15 * I,-0.925503405247892 + 2.61260391056328e-16 * I,0.450178655183209 + 1.86641816419183e-16 * I,-0.170966366766510 + 9.34189332571083e-16 * I,0.0278556161518755 - 5.45812658538746e-17 * I,-0.00323856800725435 - 4.76333155445960e-18 * I,0.000139626086435354 - 3.07786751694951e-19 * I;
  Vector<t_complex> vis = weights;
  Matrix<t_complex> grid = op.G.adjoint() * vis;
  for (t_int i = 0; i < 400; ++i)
  {
    CHECK(std::abs(grid(i) - expected_grid(i)) < 1e-13);
  }
  grid.resize(20, 20);
  FFTOperator FFT;
  Matrix<t_complex> image(20, 20); 
  image = FFT.inverse(grid);
  image.resize(400, 1);
  Matrix<t_complex> expected_image(400, 1);
  expected_image << -5.39624306595621e-07 - 3.74741463913937e-17 * I,-5.93905861161689e-06 + 1.18596781210398e-05 * I,-3.34039654697625e-05 + 0.000114954755349537 * I,-0.000229929609058215 + 0.000439231100735958 * I,-0.00218213535948203 - 0.00126366556102078 * I,0.000143004598977806 + 0.000533134130587545 * I,9.50692467193662e-05 + 0.000374528922332005 * I,5.05206584371760e-05 - 1.46887849369110e-05 * I,3.60832091805541e-06 - 0.000341136119526574 * I,-3.47403579362110e-05 - 0.000330090278259859 * I,-4.98027502968124e-05 - 1.84985862891259e-17 * I,-3.47403579361999e-05 + 0.000330090278259826 * I,3.60832091801863e-06 + 0.000341136119526771 * I,5.05206584371988e-05 + 1.46887849368673e-05 * I,9.50692467194522e-05 - 0.000374528922332019 * I,0.000143004598977898 - 0.000533134130587679 * I,-0.00218213535948222 + 0.00126366556102094 * I,-0.000229929609058029 - 0.000439231100735990 * I,-3.34039654697492e-05 - 0.000114954755349612 * I,-5.93905861163389e-06 - 1.18596781210426e-05 * I,-5.22518642581932e-06 - 9.58835684702322e-07 * I,3.05812212221912e-05 + 1.08222831767300e-05 * I,0.000393095523570596 + 0.000126461524608617 * I,-0.00262555020592432 - 0.00147395890519616 * I,0.000119906944679496 + 5.70888408571270e-05 * I,0.000553800533124496 + 9.38708970214632e-05 * I,0.000451332891059525 + 6.67416259131207e-05 * I,-6.79419078276220e-05 - 3.82276421536934e-05 * I,-0.000551324499865195 - 0.000126395121274016 * I,-0.000518953867523182 - 9.96760160420662e-05 * I,5.04784041690581e-05 + 3.68687639941236e-05 * I,0.000636996628136671 + 0.000162243615783156 * I,0.000649905610793476 + 0.000145707854461471 * I,-2.96663271404253e-05 - 3.65354474258904e-05 * I,-0.00103360022943357 - 0.000311496277494001 * I,-0.00265360333647809 - 0.000921241592623864 * I,1.70464318903985e-05 - 0.00104736812385348 * I,-0.000312279813541750 - 4.34406229271515e-05 * I,-0.000126711983321326 - 1.82069834994942e-05 * I,-1.47669981033238e-05 - 8.76381836016258e-07 * I,4.56132048467504e-06 + 2.45836992810372e-05 * I,-1.22139357329976e-05 - 7.64840743892717e-05 * I,-0.000429958204598609 - 0.00272464809935349 * I,0.000342943392218054 + 0.00103159842856505 * I,-2.12829204790705e-05 - 0.000151386238861985 * I,-0.000164746710840133 - 0.000857946378409604 * I,-0.000151408259715171 - 0.000766310585804978 * I,1.46712210381395e-05 + 0.000117385461269848 * I,0.000189761845887444 + 0.00102866767450189 * I,0.000193127887263433 + 0.00101152170303051 * I,-8.86929141850016e-06 - 9.60086046348847e-05 * I,-0.000242303851206526 - 0.00134613507881168 * I,-0.000271981738020698 - 0.00147193441201082 * I,-5.94994273867030e-07 + 6.29494948672365e-05 * I,0.000582061885074922 + 0.00346408168833134 * I,-0.00132463852292753 - 0.0106618430526757 * I,-2.14959631828425e-05 - 1.33428361710183e-05 * I,8.60804879341302e-05 + 0.000444275666423098 * I,4.06924083978489e-05 + 0.000206188882288917 * I,6.49827365884605e-06 + 3.13104413819572e-05 * I,6.10539683089065e-05 - 5.37912240198882e-05 * I,-0.000160017707998963 + 0.000139778525186564 * I,0.00223145624248279 - 0.00190202729616752 * I,0.000813174821772529 - 0.000726455446021131 * I,-0.000137817975439904 + 0.000119773203098476 * I,-0.000938256899093752 + 0.000829099386266552 * I,-0.000903106530255343 + 0.000799630053914517 * I,0.000129697321904946 - 0.000111969639353709 * I,0.00130006746768979 - 0.00114664781899119 * I,0.00134401650159928 - 0.00118781388129451 * I,-0.000111941020276118 + 9.53980702689459e-05 * I,-0.00194121221220973 + 0.00170946529107411 * I,-0.00233372243855390 + 0.00205763963209097 * I,7.47385844826709e-05 - 6.00115157751431e-05 * I,0.0174682085162213 - 0.0152694408130353 * I,-0.00324992809241865 + 0.00297312816663438 * I,-2.88731247823138e-05 + 2.90942674230285e-05 * I,0.000460001203283757 - 0.000406530303907629 * I,0.000235183156143996 - 0.000208187841953804 * I,4.67632070717813e-05 - 4.14546840082007e-05 * I,-0.000240710803174970 - 6.99082930795437e-05 * I,0.00482443842405665 + 0.00140387956199274 * I,-0.00162474757777334 - 0.000469803677611316 * I,-0.00114784329574285 - 0.000332534896337540 * I,0.000206868751742256 + 6.02724733891157e-05 * I,0.00163125667891245 + 0.000473309539033412 * I,0.00167068491776866 + 0.000484524515613889 * I,-0.000224025439778981 - 6.53355540861404e-05 * I,-0.00256944236341568 - 0.000745820995451038 * I,-0.00279411684847069 - 0.000810678917977648 * I,0.000203258729357145 + 5.95613782529327e-05 * I,0.00447586928991488 + 0.00129961068593219 * I,0.00615679796748222 + 0.00178740557328850 * I,-0.000136045815775318 - 4.08662180529837e-05 * I,0.0169270183687826 + 0.00495634803307813 * I,0.00378991571998098 + 0.00109714124733677 * I,6.33611529012005e-05 + 1.80465655762625e-05 * I,-0.000767471108438950 - 0.000222678973988604 * I,-0.000423547317578411 - 0.000122835032923541 * I,-0.000112143845520402 - 3.25150905315813e-05 * I,0.000291791369245180 + 0.000986363510120250 * I,9.27547506645123e-05 + 0.000314169208948559 * I,0.000423532590060551 + 0.00143147477213203 * I,0.000381520957702218 + 0.00128953366745243 * I,-6.99924702099201e-05 - 0.000236541859435766 * I,-0.000624750891272999 - 0.00211175429334660 * I,-0.000675203800272113 - 0.00228223296140145 * I,8.49716568596809e-05 + 0.000287337277140942 * I,0.00110983911185556 + 0.00375132341760292 * I,0.00127285784869205 + 0.00430244751567387 * I,-8.13045063010561e-05 - 0.000274820255891055 * I,-0.00234893368111973 - 0.00794003478700322 * I,-0.00406747425858043 - 0.0137493839234075 * I,0.0211976615512716 + 0.0716595357244715 * I,-0.00283751508179877 - 0.00959068608203821 * I,-0.00113738024027331 - 0.00384442582480681 * I,-2.74580908152006e-05 - 9.27690598697952e-05 * I,0.000284168209231567 + 0.000960565612847498 * I,0.000167279821969990 + 0.000565468584639644 * I,6.25850454736501e-05 + 0.000211602142291842 * I,-0.00275417727313359 + 0.00318885838333626 * I,9.30868793335338e-05 - 0.000107743472008130 * I,0.000947717775013962 - 0.00109723589257192 * I,0.000984745948129577 - 0.00114015110455697 * I,-0.000176791741260993 + 0.000204664787806577 * I,-0.00178990917562197 + 0.00207237917427808 * I,-0.00203137015401146 + 0.00235191783625889 * I,0.000237683584036738 - 0.000275204962045314 * I,0.00357536166900239 - 0.00413955829602732 * I,0.00435485022991964 - 0.00504210556794996 * I,-0.000238485782945090 + 0.000276076779436033 * I,-0.00993182627013991 + 0.0114993723989076 * I,-0.0307766664839903 + 0.0356334297055255 * I,0.000172959301291534 - 0.000199625695619091 * I,-0.00544886129301762 + 0.00630882038104177 * I,-0.00274957018193300 + 0.00318355770827627 * I,-8.71040664723159e-05 + 0.000100843441399939 * I,0.000790000589466750 - 0.000914683414109261 * I,0.000493644245366067 - 0.000571579648221973 * I,0.000307023953854183 - 0.000355510143911579 * I,0.00132451506548845 + 0.000188786331704425 * I,-4.93336824342652e-05 - 7.00678311092340e-06 * I,-0.00142422546619258 - 0.000202979663354388 * I,-0.00164148752706907 - 0.000233976854241477 * I,0.000270909695527938 + 3.85976077807983e-05 * I,0.00323170973054522 + 0.000460637532914745 * I,0.00384893563960746 + 0.000548609714128661 * I,-0.000413691498734246 - 5.89742681873768e-05 * I,-0.00729752335570938 - 0.00104014331910355 * I,-0.00955206932151248 - 0.00136157234797808 * I,0.000434562935127629 + 6.18987157284639e-05 * I,0.0319201650284848 + 0.00454991009179719 * I,-0.115571744072044 - 0.0164745690923801 * I,-0.000326410462416650 - 4.65653768517307e-05 * I,0.00755568310342131 + 0.00107705749594892 * I,0.00435879615754039 + 0.000621339342310273 * I,0.000171883293335595 + 2.45072999938961e-05 * I,-0.00138827986741507 - 0.000197894677438334 * I,-0.000921575364353983 - 0.000131388245873425 * I,-0.00190828635296727 - 0.000272044178825397 * I,-0.000430981178052831 - 0.000941720171698006 * I,-1.37706789007491e-05 - 3.00241282805332e-05 * I,0.000589431816380220 + 0.00128802283266265 * I,0.000745203776862419 + 0.00162832022977660 * I,-0.000142437439105330 - 0.000311285043069820 * I,-0.00155771859660274 - 0.00340373625665053 * I,-0.00194562973888813 - 0.00425139176766089 * I,0.000189782472997399 + 0.000414712809340685 * I,0.00401940484711480 + 0.00878276124277002 * I,0.00577379640923282 + 0.0126160135670670 * I,-0.000207916819475413 - 0.000454507291959836 * I,-0.0616065112083811 - 0.134612555393732 * I,0.0142521245318356 + 0.0311413535804460 * I,0.000162311097804146 + 0.000354633355437590 * I,-0.00297507867708913 - 0.00650061473679017 * I,-0.00188352166212904 - 0.00411549757447800 * I,-8.93361134114390e-05 - 0.000195184342193686 * I,0.000650569680000352 + 0.00142151485241203 * I,0.000465697282294432 + 0.00101750098022301 * I,-0.000543799054027860 - 0.00118829083359489 * I,-0.000512459808631904 + 0.000798102193368992 * I,-6.86945250058188e-05 + 0.000106927730742336 * I,0.000735558705569593 - 0.00114562344904284 * I,0.00111516919513071 - 0.00173676489907581 * I,-0.000166507997630827 + 0.000259349064800164 * I,-0.00223310559519232 + 0.00347787668989296 * I,-0.00293040335911577 + 0.00456386333653090 * I,0.000255594147803598 - 0.000398093965579274 * I,0.00672938164670348 - 0.0104804022093659 * I,0.0110510563972333 - 0.0172108478767114 * I,-0.000291957464044950 + 0.000454181680561777 * I,0.0435403253461455 - 0.0678105161476230 * I,0.0117693972493135 - 0.0183293994387961 * I,0.000236545558081585 - 0.000368300011065071 * I,-0.00359978202985003 + 0.00560618609995495 * I,-0.00244911940063096 + 0.00381418191733574 * I,-0.000136466658145434 + 0.000212507942662908 * I,0.000902393130741254 - 0.00140537304985381 * I,0.00124874978397898 - 0.00194473827383244 * I,-0.000259659076011281 + 0.000404447881272929 * I,0.000927715374181806 + 2.69495740309352e-17 * I,0.000254405275444488 - 3.22091137973119e-08 * I,-0.00124866565482766 - 3.60381900498669e-08 * I,-0.00167474031115736 - 6.13297393052895e-09 * I,0.000284285392132828 + 1.78275349499695e-08 * I,0.00440213297792682 + 3.01479350820616e-08 * I,0.00609259966024559 + 4.16834065888883e-08 * I,-0.000466601474974971 - 2.01529127627151e-08 * I,-0.0161182619006620 - 9.31089732730817e-08 * I,-0.0333229711211430 + 1.56023671593619e-08 * I,0.207578734813287 - 5.20603090509463e-16 * I,-0.0333229711211431 - 1.56023668339278e-08 * I,-0.0161182619006620 + 9.31089733244295e-08 * I,-0.000466601474975188 + 2.01529127301023e-08 * I,0.00609259966024576 - 4.16834064726618e-08 * I,0.00440213297792676 - 3.01479352406153e-08 * I,0.000284285392132825 - 1.78275348928104e-08 * I,-0.00167474031115730 + 6.13297405939722e-09 * I,-0.00124866565482776 + 3.60381898269549e-08 * I,0.000254405275444497 + 3.22091138860430e-08 * I,-0.000512459808631905 - 0.000798102193369008 * I,-0.000259659076011241 - 0.000404447881272913 * I,0.00124874978397892 + 0.00194473827383243 * I,0.000902393130741285 + 0.00140537304985381 * I,-0.000136466658145473 - 0.000212507942662906 * I,-0.00244911940063098 - 0.00381418191733575 * I,-0.00359978202984997 - 0.00560618609995477 * I,0.000236545558081561 + 0.000368300011065013 * I,0.0117693972493135 + 0.0183293994387961 * I,0.0435403253461458 + 0.0678105161476229 * I,-0.000291957464045149 - 0.000454181680561785 * I,0.0110510563972334 + 0.0172108478767113 * I,0.00672938164670358 + 0.0104804022093659 * I,0.000255594147803477 + 0.000398093965579267 * I,-0.00293040335911573 - 0.00456386333653102 * I,-0.00223310559519242 - 0.00347787668989285 * I,-0.000166507997630805 - 0.000259349064800157 * I,0.00111516919513079 + 0.00173676489907573 * I,0.000735558705569541 + 0.00114562344904287 * I,-6.86945250058523e-05 - 0.000106927730742343 * I,-0.000430981178052960 + 0.000941720171697955 * I,-0.000543799054027764 + 0.00118829083359498 * I,0.000465697282294401 - 0.00101750098022305 * I,0.000650569680000291 - 0.00142151485241207 * I,-8.93361134113821e-05 + 0.000195184342193769 * I,-0.00188352166212907 + 0.00411549757447793 * I,-0.00297507867708910 + 0.00650061473679024 * I,0.000162311097804159 - 0.000354633355437581 * I,0.0142521245318353 - 0.0311413535804460 * I,-0.0616065112083804 + 0.134612555393733 * I,-0.000207916819475487 + 0.000454507291959764 * I,0.00577379640923275 - 0.0126160135670669 * I,0.00401940484711492 - 0.00878276124277033 * I,0.000189782472997219 - 0.000414712809340576 * I,-0.00194562973888803 + 0.00425139176766093 * I,-0.00155771859660272 + 0.00340373625665054 * I,-0.000142437439105551 + 0.000311285043069829 * I,0.000745203776862742 - 0.00162832022977661 * I,0.000589431816380170 - 0.00128802283266270 * I,-1.37706789007604e-05 + 3.00241282804848e-05 * I,0.00132451506548842 - 0.000188786331704297 * I,-0.00190828635296721 + 0.000272044178825287 * I,-0.000921575364354028 + 0.000131388245873419 * I,-0.00138827986741507 + 0.000197894677438355 * I,0.000171883293335638 - 2.45072999939431e-05 * I,0.00435879615754027 - 0.000621339342310270 * I,0.00755568310342132 - 0.00107705749594895 * I,-0.000326410462416703 + 4.65653768516837e-05 * I,-0.115571744072044 + 0.0164745690923807 * I,0.0319201650284848 - 0.00454991009179751 * I,0.000434562935127639 - 6.18987157284364e-05 * I,-0.00955206932151239 + 0.00136157234797815 * I,-0.00729752335570952 + 0.00104014331910344 * I,-0.000413691498734110 + 5.89742681875843e-05 * I,0.00384893563960741 - 0.000548609714128836 * I,0.00323170973054514 - 0.000460637532914839 * I,0.000270909695528142 - 3.85976077804229e-05 * I,-0.00164148752706913 + 0.000233976854241309 * I,-0.00142422546619254 + 0.000202979663354295 * I,-4.93336824342411e-05 + 7.00678311088821e-06 * I,-0.00275417727313361 - 0.00318885838333624 * I,0.000307023953854161 + 0.000355510143911540 * I,0.000493644245366109 + 0.000571579648221953 * I,0.000790000589466728 + 0.000914683414109271 * I,-8.71040664723147e-05 - 0.000100843441399976 * I,-0.00274957018193303 - 0.00318355770827626 * I,-0.00544886129301765 - 0.00630882038104175 * I,0.000172959301291541 + 0.000199625695618997 * I,-0.0307766664839904 - 0.0356334297055253 * I,-0.00993182627013995 - 0.0114993723989076 * I,-0.000238485782945162 - 0.000276076779436089 * I,0.00435485022991983 + 0.00504210556795010 * I,0.00357536166900237 + 0.00413955829602728 * I,0.000237683584036739 + 0.000275204962045256 * I,-0.00203137015401154 - 0.00235191783625883 * I,-0.00178990917562196 - 0.00207237917427819 * I,-0.000176791741261049 - 0.000204664787806412 * I,0.000984745948129649 + 0.00114015110455700 * I,0.000947717775013987 + 0.00109723589257202 * I,9.30868793336446e-05 + 0.000107743472008005 * I,0.000291791369245257 - 0.000986363510120113 * I,6.25850454737086e-05 - 0.000211602142291859 * I,0.000167279821969978 - 0.000565468584639673 * I,0.000284168209231599 - 0.000960565612847483 * I,-2.74580908151951e-05 + 9.27690598697617e-05 * I,-0.00113738024027329 + 0.00384442582480680 * I,-0.00283751508179867 + 0.00959068608203817 * I,0.0211976615512712 - 0.0716595357244716 * I,-0.00406747425858029 + 0.0137493839234076 * I,-0.00234893368111971 + 0.00794003478700320 * I,-8.13045063011406e-05 + 0.000274820255891210 * I,0.00127285784869221 - 0.00430244751567400 * I,0.00110983911185536 - 0.00375132341760292 * I,8.49716568597655e-05 - 0.000287337277140942 * I,-0.000675203800271858 + 0.00228223296140140 * I,-0.000624750891273602 + 0.00211175429334667 * I,-6.99924702097443e-05 + 0.000236541859435796 * I,0.000381520957702302 - 0.00128953366745232 * I,0.000423532590060739 - 0.00143147477213197 * I,9.27547506642937e-05 - 0.000314169208948709 * I,-0.000240710803174845 + 6.99082930795228e-05 * I,-0.000112143845520389 + 3.25150905316123e-05 * I,-0.000423547317578425 + 0.000122835032923546 * I,-0.000767471108438936 + 0.000222678973988598 * I,6.33611529012327e-05 - 1.80465655762734e-05 * I,0.00378991571998099 - 0.00109714124733676 * I,0.0169270183687826 - 0.00495634803307821 * I,-0.000136045815775305 + 4.08662180530362e-05 * I,0.00615679796748221 - 0.00178740557328855 * I,0.00447586928991490 - 0.00129961068593223 * I,0.000203258729357128 - 5.95613782528746e-05 * I,-0.00279411684847074 + 0.000810678917977586 * I,-0.00256944236341561 + 0.000745820995451142 * I,-0.000224025439778978 + 6.53355540860914e-05 * I,0.00167068491776855 - 0.000484524515614055 * I,0.00163125667891250 - 0.000473309539033326 * I,0.000206868751742193 - 6.02724733890285e-05 * I,-0.00114784329574296 + 0.000332534896337497 * I,-0.00162474757777330 + 0.000469803677611311 * I,0.00482443842405658 - 0.00140387956199259 * I,6.10539683088431e-05 + 5.37912240199338e-05 * I,4.67632070717999e-05 + 4.14546840081810e-05 * I,0.000235183156143996 + 0.000208187841953849 * I,0.000460001203283768 + 0.000406530303907648 * I,-2.88731247823434e-05 - 2.90942674229954e-05 * I,-0.00324992809241857 - 0.00297312816663431 * I,0.0174682085162213 + 0.0152694408130351 * I,7.47385844826727e-05 + 6.00115157751720e-05 * I,-0.00233372243855385 - 0.00205763963209094 * I,-0.00194121221220982 - 0.00170946529107417 * I,-0.000111941020276094 - 9.53980702688895e-05 * I,0.00134401650159932 + 0.00118781388129446 * I,0.00130006746768978 + 0.00114664781899117 * I,0.000129697321904901 + 0.000111969639353922 * I,-0.000903106530255217 - 0.000799630053914906 * I,-0.000938256899093825 - 0.000829099386266529 * I,-0.000137817975440008 - 0.000119773203098538 * I,0.000813174821772327 + 0.000726455446021378 * I,0.00223145624248299 + 0.00190202729616741 * I,-0.000160017707999033 - 0.000139778525186540 * I,4.56132048464975e-06 - 2.45836992810139e-05 * I,6.49827365880549e-06 - 3.13104413819526e-05 * I,4.06924083978651e-05 - 0.000206188882288928 * I,8.60804879341151e-05 - 0.000444275666423036 * I,-2.14959631828462e-05 + 1.33428361710636e-05 * I,-0.00132463852292746 + 0.0106618430526756 * I,0.000582061885074834 - 0.00346408168833126 * I,-5.94994273828214e-07 - 6.29494948672161e-05 * I,-0.000271981738020675 + 0.00147193441201081 * I,-0.000242303851206518 + 0.00134613507881168 * I,-8.86929141844304e-06 + 9.60086046348802e-05 * I,0.000193127887263355 - 0.00101152170303050 * I,0.000189761845887403 - 0.00102866767450186 * I,1.46712210384705e-05 - 0.000117385461269928 * I,-0.000151408259715330 + 0.000766310585804996 * I,-0.000164746710840227 + 0.000857946378409517 * I,-2.12829204791145e-05 + 0.000151386238861929 * I,0.000342943392218269 - 0.00103159842856495 * I,-0.000429958204598777 + 0.00272464809935327 * I,-1.22139357330636e-05 + 7.64840743893829e-05 * I,-5.22518642578830e-06 + 9.58835684715442e-07 * I,-1.47669981033396e-05 + 8.76381836023305e-07 * I,-0.000126711983321382 + 1.82069834995041e-05 * I,-0.000312279813541760 + 4.34406229270463e-05 * I,1.70464318902974e-05 + 0.00104736812385358 * I,-0.00265360333647807 + 0.000921241592623862 * I,-0.00103360022943354 + 0.000311496277494053 * I,-2.96663271404565e-05 + 3.65354474259278e-05 * I,0.000649905610793471 - 0.000145707854461498 * I,0.000636996628136700 - 0.000162243615783136 * I,5.04784041690587e-05 - 3.68687639941216e-05 * I,-0.000518953867523170 + 9.96760160420912e-05 * I,-0.000551324499865231 + 0.000126395121273984 * I,-6.79419078275521e-05 + 3.82276421537632e-05 * I,0.000451332891059568 - 6.67416259131536e-05 * I,0.000553800533124620 - 9.38708970214466e-05 * I,0.000119906944679415 - 5.70888408572988e-05 * I,-0.00262555020592430 + 0.00147395890519617 * I,0.000393095523570511 - 0.000126461524608594 * I,3.05812212221903e-05 - 1.08222831768156e-05 * I;
  for (t_int i = 0; i < 400; ++i)
  {
    CHECK(std::abs(image(i) - expected_image(i)) < 1e-13);
  }
  Matrix<t_complex> final_expected_image(100, 1);
  final_expected_image << -0.0124950178254600 - 0.0422350858669319 * I,-0.0135040760054423 - 0.0456446592280289 * I,0.00169943313719362 + 0.00574674554281884 * I,0.0221967822371112 + 0.0750264683520583 * I,0.0254571569738410 + 0.0860489503134775 * I,-0.00162609012602112 - 0.00549640511782110 * I,-0.0469786736223945 - 0.158800695740064 * I,-0.0813494851716086 - 0.274987678468150 * I,0.423953231025432 + 1.43319071448943 * I,-0.0567503016359753 - 0.191813721640764 * I,-0.0357981835124394 + 0.0414475834855616 * I,-0.0406274030802293 + 0.0470383567251779 * I,0.00475367168073476 - 0.00550409924090628 * I,0.0715072333800478 - 0.0827911659205464 * I,0.0870970045983929 - 0.100842111358999 * I,-0.00476971565890180 + 0.00552153558872066 * I,-0.198636525402798 + 0.229987447978153 * I,-0.615533329679806 + 0.712668594110510 * I,0.00345918602583068 - 0.00399251391238182 * I,-0.108977225860352 + 0.126176407620835 * I,0.0646341946109044 + 0.00921275065829491 * I,0.0769787127921493 + 0.0109721942825732 * I,-0.00827382997468492 - 0.00117948536374754 * I,-0.145950467114188 - 0.0208028663820710 * I,-0.191041386430250 - 0.0272314469595616 * I,0.00869125870255258 + 0.00123797431456928 * I,0.638403300569695 + 0.0909982018359438 * I,-2.31143488144088 - 0.329491381847602 * I,-0.00652820924833301 - 0.000931307537034615 * I,0.151113662068426 + 0.0215411499189783 * I,-0.0311543719320549 - 0.0680747251330106 * I,-0.0389125947777627 - 0.0850278353532178 * I,0.00379564945994798 + 0.00829425618681370 * I,0.0803880969422959 + 0.175655224855400 * I,0.115475928184656 + 0.252320271341340 * I,-0.00415833638950825 - 0.00909014583919672 * I,-1.23213022416762 - 2.69225110787465 * I,0.285042490636712 + 0.622827071608919 * I,0.00324622195608291 + 0.00709266710875179 * I,-0.0595015735417825 - 0.130012294735803 * I,-0.0446621119038463 + 0.0695575337978592 * I,-0.0586080671823155 + 0.0912772667306181 * I,0.00511188295607195 - 0.00796187931158548 * I,0.134587632934070 - 0.209608044187318 * I,0.221021127944667 - 0.344216957534228 * I,-0.00583914928089899 + 0.00908363361123555 * I,0.870806506922909 - 1.35621032295246 * I,0.235387944986269 - 0.366587988775922 * I,0.00473091116163171 - 0.00736600022130142 * I,-0.0719956405970005 + 0.112123721999099 * I,0.0880426595585364 + 6.02958701641232e-07 * I,0.121851993204912 + 8.33668131777765e-07 * I,-0.00933202949949942 - 4.03058255254302e-07 * I,-0.322365238013241 - 1.86217946546163e-06 * I,-0.666459422422861 + 3.12047343187238e-07 * I,4.15157469626574 - 1.04120618101893e-14 * I,-0.666459422422863 - 3.12047336678556e-07 * I,-0.322365238013241 + 1.86217946648859e-06 * I,-0.00933202949950377 + 4.03058254602046e-07 * I,0.121851993204915 - 8.33668129453236e-07 * I,-0.0489823880126197 - 0.0762836383467150 * I,-0.0719956405969994 - 0.112123721999095 * I,0.00473091116163122 + 0.00736600022130027 * I,0.235387944986271 + 0.366587988775922 * I,0.870806506922916 + 1.35621032295246 * I,-0.00583914928090299 - 0.00908363361123571 * I,0.221021127944669 + 0.344216957534227 * I,0.134587632934072 + 0.209608044187318 * I,0.00511188295606955 + 0.00796187931158534 * I,-0.0586080671823146 - 0.0912772667306203 * I,-0.0376704332425815 + 0.0823099514895586 * I,-0.0595015735417821 + 0.130012294735805 * I,0.00324622195608318 - 0.00709266710875161 * I,0.285042490636706 - 0.622827071608920 * I,-1.23213022416761 + 2.69225110787465 * I,-0.00415833638950974 + 0.00909014583919528 * I,0.115475928184655 - 0.252320271341339 * I,0.0803880969422984 - 0.175655224855407 * I,0.00379564945994439 - 0.00829425618681151 * I,-0.0389125947777606 + 0.0850278353532186 * I,0.0871759231508054 - 0.0124267868462054 * I,0.151113662068426 - 0.0215411499189790 * I,-0.00652820924833405 + 0.000931307537033674 * I,-2.31143488144088 + 0.329491381847613 * I,0.638403300569696 - 0.0909982018359502 * I,0.00869125870255277 - 0.00123797431456873 * I,-0.191041386430248 + 0.0272314469595630 * I,-0.145950467114190 + 0.0208028663820688 * I,-0.00827382997468219 + 0.00117948536375169 * I,0.0769787127921481 - 0.0109721942825767 * I,-0.0549914036386605 - 0.0636711541655252 * I,-0.108977225860353 - 0.126176407620835 * I,0.00345918602583083 + 0.00399251391237994 * I,-0.615533329679808 - 0.712668594110507 * I,-0.198636525402799 - 0.229987447978152 * I,-0.00476971565890324 - 0.00552153558872178 * I,0.0870970045983966 + 0.100842111359002 * I,0.0715072333800474 + 0.0827911659205456 * I,0.00475367168073479 + 0.00550409924090511 * I,-0.0406274030802307 - 0.0470383567251766 * I;
  op.S.setOnes();
  Matrix<t_complex> final_image = op.grid(weights) * 20; //matlab image is normalized differently due to the FFT, hence factor of 20
  final_expected_image.resize(10, 10);
  //std::cout << final_expected_image << '\n';
  //std::cout << " ---------- " << '\n';
  //std::cout << final_image << '\n';

  for (t_int i = 0; i < 10; ++i)
  {
    for (t_int j = 0; j < 10; ++j)
    {
      CHECK(std::abs(final_image(i, j) - final_expected_image(i, j)) < 1e-13);
    }
  }
}

TEST_CASE("Measurement Operator [Gridding]", "[Gridding]") {

  /*
    Tests each kernel by gridding visibility data and a point spread function, then comparing the gridded images to the same images generated from matlab.

    So far the maximum difference between the gridded images of at166B are 0.00015% (kb), 0.1071% (pswf), and 0.0362% (guass).

    Since there is small difference between the end results, it suggests that the C++ and Matlab codes perform the same process.
    But, it is not clear why the pswf and guass kernels are not as close to the matlab versions as the kb kernel.

  */
  
  utilities::vis_params uv_vis;
  t_real max;
  t_real max_diff;
  t_int over_sample;
  t_real cellsize;
  std::string kernel;
  

  //Gridding example
  over_sample = 2;
  t_int J = 6;
  uv_vis = utilities::read_visibility(vla_filename("at166B.3C129.c0.vis")); // visibility data being read in
  cellsize = 0.3;
  uv_vis = utilities::set_cell_size(uv_vis, cellsize, cellsize); // scale uv coordinates to correct pixel size and to units of 2pi
  uv_vis = utilities::uv_scale(uv_vis, 1024 * over_sample, 1024 * over_sample); // scale uv coordinates to units of Fourier grid size
  uv_vis = utilities::uv_symmetry(uv_vis); // Enforce condjugate symmetry by reflecting measurements in uv coordinates
  Vector<t_complex> point_source = uv_vis.vis * 0; point_source.setOnes();  // Creating model visibilities for point source
  Image<t_complex> psf;
  //Amount in which images are shifted relative to each other
  t_int j_shift = - 0;
  t_int i_shift = - 1;

  SECTION("Kaiser Bessel Gridding") {
    kernel = "kb";
    MeasurementOperator op(uv_vis.u, uv_vis.v, uv_vis.weights, J, J, kernel, 1024, 1024, over_sample); // Generating gridding matrix

    psf = op.grid(point_source);
    max = psf.real().maxCoeff();
    psf = psf / max;
    pfitsio::write2d(psf.real(), output_filename("kb_psf.fits"), true, false);


    Image<t_real> kb_img = op.grid(uv_vis.vis).real();
    max = kb_img.maxCoeff();
    kb_img = kb_img / max;
    pfitsio::write2d(kb_img.real(), output_filename("grid_image_real_kb_6.fits"), true, false);


    Image<t_real> kb_test_image = pfitsio::read2d(gridding_filename("at166BtestJ6kb.fits")).real();
    
    max_diff = 0;
    for (t_int i = 2; i < kb_test_image.cols() - 2; ++i)
    {
      for (t_int j = 2; j < kb_test_image.rows() - 2; ++j)
      {
        if (std::abs(kb_img(j, i) - kb_test_image(j + j_shift, i + i_shift)) > max_diff)
        {
          max_diff = std::abs(kb_img(j, i) - kb_test_image(j + j_shift, i + i_shift));
        }
        if (std::abs(kb_img(j, i) - kb_test_image(j + j_shift, i + i_shift)) >= 0.05)
        {
          std::cout << i << " " << j << '\n';
        }
        CHECK( std::abs(kb_img(j, i) - kb_test_image(j + j_shift, i + i_shift)) < 0.05 );
      }
    }
    std::cout << "Percentage max difference in Kaiser Bessel gridding: " << max_diff * 100 << "%" << '\n';
    std::cout << kb_img(0, 0) << " " << kb_img(0, 1023) << " " << kb_test_image(0, 0) << " " << kb_test_image(0, 1023) << '\n';
    std::cout << kb_img(0, 0) << " " << kb_img(1023, 0) << " " << kb_test_image(0, 0) << " " << kb_test_image(1023, 0) << '\n';
  }
  SECTION("Prolate Spheroidal Wave Functon Gridding") {
    kernel = "pswf";
    MeasurementOperator op(uv_vis.u, uv_vis.v, uv_vis.weights, J, J, kernel, 1024, 1024, over_sample); // Generating gridding matrix
    Image<t_real> pswf_img = op.grid(uv_vis.vis).real();
    max = pswf_img.maxCoeff();
    pswf_img = pswf_img / max;
    pfitsio::write2d(pswf_img.real(), output_filename("grid_image_real_pswf_6.fits"), true, false);
    pfitsio::write2d(op.S.real(), output_filename("grid_scale_real_pswf_6.fits"), true, false);

    Image<t_real> pswf_test_image = pfitsio::read2d(gridding_filename("at166BtestJ6pswf.fits")).real();
    Image<t_real> pswf_difference = pswf_img - pswf_test_image;
    max_diff = pswf_difference.abs().maxCoeff();
    
    max_diff = 0;
    for (t_int i = 1; i < pswf_test_image.cols() - 1; ++i)
    {
      for (t_int j = 1; j < pswf_test_image.rows() - 1; ++j)
      {
        if (std::abs(pswf_img(j, i) - pswf_test_image(j + j_shift, i + i_shift)) > max_diff)
        {
          max_diff = std::abs(pswf_img(j, i) - pswf_test_image(j + j_shift, i + i_shift));
        }
        if (std::abs(pswf_img(j, i) - pswf_test_image(j + j_shift, i + i_shift)) >= 0.05)
        {
          CAPTURE(i);
          CAPTURE(j);
        }
        CHECK( std::abs(pswf_img(j, i) - pswf_test_image(j + j_shift, i + i_shift)) < 0.05 );
      }
    }
    INFO("Percentage max difference in Prolate Spheroidal Wave Functon gridding: " << max_diff * 100 << "%");
  }
  SECTION("Gaussian Gridding") {
    kernel = "gauss";
    MeasurementOperator op(uv_vis.u, uv_vis.v, uv_vis.weights, J, J, kernel, 1024, 1024, over_sample); // Generating gridding matrix
    Image<t_real> gauss_img = op.grid(uv_vis.vis).real();
    max = gauss_img.maxCoeff();
    gauss_img = gauss_img / max;

    Image<t_real> gauss_test_image = pfitsio::read2d(gridding_filename("at166BtestJ6gauss.fits")).real();
    Image<t_real> gauss_difference = gauss_img - gauss_test_image;
    max_diff = gauss_difference.abs().maxCoeff();
    
    max_diff = 0;
    for (t_int i = 1; i < gauss_test_image.cols() - 1; ++i)
    {
      for (t_int j = 1; j < gauss_test_image.rows() - 1; ++j)
      {
        if (std::abs(gauss_img(j, i) - gauss_test_image(j + j_shift, i + i_shift)) > max_diff)
        {
          max_diff = std::abs(gauss_img(j, i) - gauss_test_image(j + j_shift, i + i_shift));
        }
        if (std::abs(gauss_img(j, i) - gauss_test_image(j + j_shift, i + i_shift)) >= 0.05)
        {
          CAPTURE(i);
          CAPTURE(j);
        }
        CHECK( std::abs(gauss_img(j, i) - gauss_test_image(j + j_shift, i + i_shift)) < 0.05 );
      }
    }
    INFO("Percentage max difference in Gaussian gridding: " << max_diff * 100 << "%");
  }  

}

TEST_CASE("Measurement Operator [Degridding]", "[Degridding]") {
  /*
    Degrids a model point source, and then compares how close the degridded visibilities are to that of a point source.

    Also generates a degridded image of M31.
  
    We find the maximum difference in visibilities is 0.001% (kb), 0.842% (pswf), and 0.056% (gauss).

    Again, the kb Kernel gives closer to the expected result. PSWF gives a result that is worse than expected.
  */
  
  utilities::vis_params uv_vis;
  t_real max;
  t_real max_diff;
  t_int over_sample;
  t_real cellsize;
  std::string kernel;
  Image<t_complex> img;
  Image<t_complex> point;
  Vector<t_complex> psf_vis;
  Image<t_complex> psf;

  SECTION("Kaiser Bessel Degridding") {
    kernel = "kb";
    over_sample = 2;
    t_int J = 6;
    uv_vis = utilities::read_visibility(degridding_filename("M31_J6kb.vis"));
    img = pfitsio::read2d(image_filename("M31.fits"));
    uv_vis = utilities::uv_scale(uv_vis, img.cols() * over_sample, img.rows() * over_sample);
    MeasurementOperator op(uv_vis.u, -uv_vis.v, uv_vis.weights, J, J, kernel, img.cols(), img.rows(), over_sample); // Calculates gridding matrix

    point = Image<t_complex>::Zero(img.cols(), img.rows()); point(floor(img.cols()/2) - 1, floor(img.rows()/2) - 1) = 1; // Creating model of point source in image
    psf_vis = op.degrid(point); // Creating visibilities from model
    max = psf_vis.cwiseAbs().maxCoeff();
    psf_vis = psf_vis / max; // normalized visibilities
    psf = op.grid(psf_vis); // gridding model visibilities into image
    max = psf.real().maxCoeff();
    psf = psf / max;
    pfitsio::write2d(point.real(), output_filename("point.fits"), true, false);
    pfitsio::write2d(psf.real(), output_filename("kb_psf_M31_degridding.fits"), true, false); // saving image of degridded point source


    Vector<t_complex> kb_vis = op.degrid(img); // visibilities of degridded model
    Image<t_complex> kb_img = op.grid(kb_vis); // image of degridded model
    max = kb_img.real().maxCoeff();
    kb_img = kb_img / max; // normalisation of degridded model

    pfitsio::write2d(kb_img.real(), output_filename("kb_test.fits"), true, false);

    max = kb_vis.cwiseAbs().maxCoeff();
    kb_vis = kb_vis / max;
    max_diff = 0;
    
    for (int i = 0; i < psf_vis.size(); ++i)
    {
      if (std::abs(std::abs(psf_vis(i)) - 1) > max_diff)
      {
        max_diff = std::abs(std::abs(psf_vis(i)) - 1);
      }
      // checking visibilities of degridded point source
      CHECK( std::abs(std::abs(psf_vis(i)) - 1) < 0.0001);
    }
    INFO("Percentage max difference in Kaiser Bessel degridding: " << max_diff * 100 << "%");
    psf_vis.setOnes();
    psf = op.grid(psf_vis);
    max = psf.real().maxCoeff();
    psf = psf / max;
    pfitsio::write2d(psf.real(), "kb_psf_M31_gridding.fits", true, false); // saving image of degridded point source
  }

  SECTION("Prolate Spheroidal Wave Functon Degridding") {
    kernel = "pswf";
    over_sample = 2;
    t_int J = 6;
    uv_vis = utilities::read_visibility("../data/expected/degridding/M31_J6kb.vis");
    img = pfitsio::read2d("../data/images/M31.fits");
    uv_vis = utilities::uv_scale(uv_vis, img.cols() * over_sample, img.rows() * over_sample);
    MeasurementOperator op(uv_vis.u, -uv_vis.v, uv_vis.weights, J, J, kernel, img.cols(), img.rows(), over_sample); // Calculates gridding matrix

    point = Image<t_complex>::Zero(img.cols(), img.rows()); point(floor(img.cols()/2) - 1, floor(img.rows()/2) - 1) = 1; // Creating model of point source in image
    psf_vis = op.degrid(point); // Creating visibilities from model
    max = psf_vis.cwiseAbs().maxCoeff();
    psf_vis = psf_vis / max; // normalized visibilities
    psf = op.grid(psf_vis); // gridding model visibilities into image
    max = psf.real().maxCoeff();
    psf = psf / max;
    pfitsio::write2d(psf.real(), output_filename("pswf_psf_M31_degridding.fits"), true, false); // saving image of degridded point source


    Vector<t_complex> pswf_vis = op.degrid(img); // visibilities of degridded model
    Image<t_complex> pswf_img = op.grid(pswf_vis); // image of degridded model
    max = pswf_img.real().maxCoeff();
    pswf_img = pswf_img / max; // normalisation of degridded model

    pfitsio::write2d(pswf_img.real(), output_filename("pswf_test.fits"), true, false);

    max = pswf_vis.cwiseAbs().maxCoeff();
    pswf_vis = pswf_vis / max;
    max_diff = 0;

    for (int i = 0; i < psf_vis.size(); ++i)
    {
      if (std::abs(std::abs(psf_vis(i)) - 1) > max_diff)
      {
        max_diff = std::abs(std::abs(psf_vis(i)) - 1);
      }
      // checking visibilities of degridded point source
      CHECK( std::abs(std::abs(psf_vis(i)) - 1) < 0.01);
    }
    INFO("Percentage max difference in Prolate Spheroidal Wave Functon degridding: " << max_diff * 100 << "%");
    psf_vis.setOnes();
    psf = op.grid(psf_vis);
    max = psf.real().maxCoeff();
    psf = psf / max;
    pfitsio::write2d(psf.real(), output_filename("pswf_psf_M31_gridding.fits"), true, false); // saving image of degridded point source
  }

  SECTION("Gaussian Degridding") {
    kernel = "gauss";
    over_sample = 2;
    t_int J = 6;
    uv_vis = utilities::read_visibility(degridding_filename("M31_J6kb.vis"));
    img = pfitsio::read2d(image_filename("M31.fits"));
    uv_vis = utilities::uv_scale(uv_vis, img.cols() * over_sample, img.rows() * over_sample);
    MeasurementOperator op(uv_vis.u, -uv_vis.v, uv_vis.weights, J, J, kernel, img.cols(), img.rows(), over_sample); // Calculates gridding matrix

    point = Image<t_complex>::Zero(img.cols(), img.rows()); point(floor(img.cols()/2), floor(img.rows()/2)) = 1; // Creating model of point source in image
    psf_vis = op.degrid(point); // Creating visibilities from model
    max = psf_vis.cwiseAbs().maxCoeff();
    psf_vis = psf_vis / max; // normalized visibilities
    psf = op.grid(psf_vis); // gridding model visibilities into image
    max = psf.real().maxCoeff();
    psf = psf / max;
    pfitsio::write2d(psf.real(), output_filename("gauss_psf_M31_degridding.fits"), true, false); // saving image of degridded point source


    Vector<t_complex> gauss_vis = op.degrid(img); // visibilities of degridded model
    Image<t_complex> gauss_img = op.grid(gauss_vis); // image of degridded model
    max = gauss_img.real().maxCoeff();
    gauss_img = gauss_img / max; // normalisation of degridded model

    pfitsio::write2d(gauss_img.real(), output_filename("gauss_test.fits"), true, false);

    max = gauss_vis.cwiseAbs().maxCoeff();
    gauss_vis = gauss_vis / max;
    max_diff = 0;

    for (int i = 0; i < psf_vis.size(); ++i)
    {
      if (std::abs(std::abs(psf_vis(i)) - 1) > max_diff)
      {
        max_diff = std::abs(std::abs(psf_vis(i)) - 1);
      }
      // checking visibilities of degridded point source
      CHECK( std::abs(std::abs(psf_vis(i)) - 1) < 0.01);
    }
    INFO("Percentage max difference in Gaussian degridding: " << max_diff * 100 << "%");
    psf_vis.setOnes();
    psf = op.grid(psf_vis);
    max = psf.real().maxCoeff();
    psf = psf / max;
    pfitsio::write2d(psf.real(), output_filename("gauss_psf_M31_gridding.fits"), true, false); // saving image of degridded point source
  }
}
